<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rechnungsdatenextraktion KI ‚Äì Automatische Rechnungsverarbeitung mit n8n | Kortex System</title>
  <meta name="description" content="Rechnungen automatisch digitalisieren mit KI. n8n Workflow extrahiert Rechnungsdaten DSGVO-konform in Sekunden. 95% Genauigkeit. Kostenlose Demo jetzt testen!">
  <meta name="keywords" content="Rechnungsdatenextraktion KI, Rechnungen digitalisieren, Rechnungsverarbeitung automatisieren, DSGVO Rechnungen, Rechnungen OCR, Invoice Processing">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://www.kortex-system.com/rechnungsdatenextraktion.html">
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Rechnungsdatenextraktion KI ‚Äì Automatische Rechnungsverarbeitung mit n8n">
  <meta property="og:description" content="Rechnungen automatisch digitalisieren mit KI. n8n Workflow extrahiert Rechnungsdaten DSGVO-konform in Sekunden.">
  <meta property="og:url" content="https://www.kortex-system.com/rechnungsdatenextraktion.html">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Kortex System">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Rechnungsdatenextraktion KI ‚Äì Automatische Rechnungsverarbeitung">
  <meta name="twitter:description" content="Rechnungen automatisch digitalisieren mit KI. n8n Workflow extrahiert Rechnungsdaten DSGVO-konform.">
  
  <script src="translations.js"></script>
  <script src="i18n.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #0a1628 0%, #09182F 100%);
      min-height: 100vh;
      color: white;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 60px 20px;
    }
    
    header {
      text-align: center;
      margin-bottom: 3rem;
    }
    
    h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .subtitle {
      font-size: 1.3rem;
      color: #94a3b8;
      margin-bottom: 1rem;
    }
    
    /* Short Intro Section */
    .intro-section {
      max-width: 900px;
      margin: 0 auto 3rem;
      text-align: center;
    }
    
    .intro-section h2 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
      color: #60a5fa;
    }
    
    .intro-section p {
      font-size: 1.1rem;
      line-height: 1.8;
      color: #cbd5e1;
      margin-bottom: 1.5rem;
    }
    
    /* Demo Grid - Similar to Business Card Page */
    .demo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin: 3rem 0;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .demo-card-link {
      text-decoration: none;
      color: inherit;
      display: block;
      cursor: pointer;
    }
    
    .demo-card-link:hover {
      text-decoration: none;
    }
    
    .demo-card {
      background: rgba(15, 23, 42, 0.8);
      border: 2px solid rgba(148, 163, 184, 0.2);
      border-radius: 16px;
      padding: 1.5rem;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .demo-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(96, 165, 250, 0.1) 0%, rgba(167, 139, 250, 0.1) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }
    
    .demo-card:hover::before {
      opacity: 1;
    }
    
    .demo-card:hover {
      border-color: rgba(96, 165, 250, 0.5);
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
    }
    
    .demo-card > * {
      position: relative;
      z-index: 1;
    }
    
    .demo-card img {
      width: 100%;
      max-width: 100%;
      max-height: 200px;
      height: auto;
      object-fit: contain;
      border-radius: 12px;
      border: 2px solid rgba(148, 163, 184, 0.3);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      background: rgba(255, 255, 255, 0.05);
      margin-bottom: 1rem;
      cursor: pointer;
    }
    
    .demo-card iframe {
      pointer-events: none; /* Verhindere Interaktion mit iframe - nur Klick auf Card z√§hlt */
    }
    
    .demo-card h3 {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      color: #60a5fa;
    }
    
    .demo-card p {
      font-size: 0.9rem;
      color: #94a3b8;
      margin-bottom: 1rem;
      flex-grow: 1;
    }
    
    .demo-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: auto;
    }
    
    .tag {
      background: rgba(96, 165, 250, 0.2);
      color: #60a5fa;
      padding: 0.25rem 0.75rem;
      border-radius: 6px;
      font-size: 0.85rem;
      border: 1px solid rgba(96, 165, 250, 0.3);
    }
    
    .tag.success {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
      border-color: rgba(34, 197, 94, 0.3);
    }
    
    .arrow-icon {
      position: absolute;
      bottom: 1rem;
      right: 1rem;
      font-size: 1.5rem;
      color: #60a5fa;
      transition: transform 0.3s ease;
    }
    
    .demo-card:hover .arrow-icon {
      transform: translateX(4px);
    }
    
    .demo-icon {
      font-size: 3rem;
      text-align: center;
      margin-bottom: 1rem;
    }
    
    /* Results Section */
    .results-section {
      margin-top: 3rem;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 16px;
      overflow: hidden;
    }
    
    .results-header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.25rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .results-header-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .results-header-buttons button {
      background: #1e40af;
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }
    
    .results-header-buttons button:hover {
      background: #1e3a8a;
      transform: translateY(-2px);
    }
    
    .results-header-buttons button.danger {
      background: #ef4444;
    }
    
    .results-header-buttons button.danger:hover {
      background: #dc2626;
    }
    
    #results-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    #results-table thead {
      background: rgba(148, 163, 184, 0.15);
      text-align: left;
    }
    
    #results-table th {
      padding: 12px 16px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
      color: #cbd5e1;
      font-weight: 600;
    }
    
    #results-table tbody td {
      padding: 12px 16px;
      border-top: 1px solid rgba(148, 163, 184, 0.15);
      color: #cbd5e1;
    }
    
    #results-table tbody tr:hover {
      background: rgba(148, 163, 184, 0.05);
    }
    
    .invoice-row-clickable {
      cursor: pointer;
      transition: background 0.2s ease;
    }
    
    .invoice-row-clickable:hover {
      background: rgba(96, 165, 250, 0.1) !important;
    }
    
    /* Invoice Detail Modal */
    .invoice-detail-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      overflow-y: auto;
      padding: 2rem;
    }
    
    .invoice-detail-modal.active {
      display: block;
    }
    
    .invoice-detail-content {
      max-width: 1400px;
      margin: 0 auto;
      background: linear-gradient(135deg, #0a1628 0%, #09182F 100%);
      border-radius: 16px;
      padding: 2rem;
      position: relative;
      border: 1px solid rgba(148, 163, 184, 0.2);
    }
    
    .invoice-detail-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.5);
      color: #fff;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      transition: all 0.2s ease;
    }
    
    .invoice-detail-close:hover {
      background: rgba(239, 68, 68, 0.3);
      transform: scale(1.1);
    }
    
    .invoice-detail-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 2rem;
      margin-top: 2rem;
    }
    
    .invoice-detail-card {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 12px;
      padding: 1.5rem;
    }
    
    .invoice-preview-card {
      height: calc(100vh - 200px);
      min-height: 600px;
      overflow: hidden;
    }
    
    .invoice-preview-header {
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
      background: rgba(15, 23, 42, 0.95);
    }
    
    .invoice-detail-card h3 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      color: #60a5fa;
    }
    
    .image-preview-container {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      background: transparent;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .invoice-preview {
      max-width: 100%;
      width: 100%;
      border-radius: 8px;
      border: 2px solid rgba(148, 163, 184, 0.2);
      margin-bottom: 1rem;
      background: #fff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 1rem;
    }
    
    .invoice-preview img {
      width: auto;
      max-width: 100%;
      height: auto;
      max-height: 80vh;
      object-fit: contain;
      display: block;
      border-radius: 8px;
      /* DIN A4 Verh√§ltnis: 210mm x 297mm = 1:1.414 */
      aspect-ratio: 210 / 297;
    }
    
    .invoice-preview iframe,
    .invoice-preview object {
      width: 100%;
      height: 100%;
      min-height: 600px;
      max-height: none;
      border: none;
      border-radius: 8px;
      display: block;
      /* PDF mit Toolbar und Scrollbar f√ºr mehrseitige Dokumente */
    }
    
    .invoice-preview-wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: stretch;
      overflow: hidden;
      flex: 1;
      min-height: 0;
    }
    
    .pdf-preview-container {
      width: 100%;
      height: 100%;
      position: relative;
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 600px;
      background: #ffffff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(148, 163, 184, 0.2);
    }
    
    .pdf-object {
      display: block;
      width: 100%;
      height: 100%;
      flex: 1;
      min-height: 600px;
      border: none;
      margin: 0;
      padding: 0;
    }
    
    .pdf-iframe {
      display: none;
      width: 100%;
      height: 100%;
      flex: 1;
      min-height: 600px;
      border: none;
      margin: 0;
      padding: 0;
    }
    
    .pdf-fallback {
      display: none;
      text-align: center;
      padding: 1rem;
      margin-top: 1rem;
    }
    
    .pdf-link-btn {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      background: rgba(96, 165, 250, 0.2);
      border: 2px solid rgba(96, 165, 250, 0.5);
      border-radius: 8px;
      color: #60a5fa;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s ease;
    }
    
    .pdf-link-btn:hover {
      background: rgba(96, 165, 250, 0.3);
      border-color: rgba(96, 165, 250, 0.7);
    }
    
    /* If object tag not supported, show iframe */
    @supports not (object-fit: contain) {
      .pdf-object {
        display: none;
      }
      .pdf-iframe {
        display: block;
      }
    }
    
    /* Mobile: Show fallback link */
    @media (max-width: 768px) {
      .pdf-object,
      .pdf-iframe {
        min-height: 400px;
      }
      
      .pdf-fallback {
        display: block;
      }
    }
    
    .invoice-line-items-container {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin-top: 1rem;
      border-radius: 8px;
      border: 1px solid rgba(148, 163, 184, 0.2);
    }
    
    .invoice-line-items {
      width: 100%;
      min-width: 600px;
      border-collapse: collapse;
      margin: 0;
    }
    
    .invoice-line-items thead {
      background: rgba(96, 165, 250, 0.15);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .invoice-line-items th {
      padding: 14px 16px;
      text-align: left;
      border-bottom: 2px solid rgba(96, 165, 250, 0.3);
      color: #e2e8f0;
      font-weight: 700;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .invoice-line-items th:last-child,
    .invoice-line-items td:last-child {
      text-align: right;
    }
    
    .invoice-line-items td {
      padding: 14px 16px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
      color: #cbd5e1;
      font-size: 0.95rem;
    }
    
    .invoice-line-items tbody tr {
      transition: background-color 0.2s ease;
    }
    
    .invoice-line-items tbody tr:hover {
      background: rgba(96, 165, 250, 0.05);
    }
    
    .invoice-line-items tr:last-child td {
      border-bottom: none;
    }
    
    .invoice-line-items td:first-child {
      font-weight: 500;
      color: #e2e8f0;
    }
    
    .invoice-line-items td:last-child {
      font-weight: 600;
      color: #60a5fa;
    }
    
    .invoice-info-item {
      margin-bottom: 1.25rem;
      padding-bottom: 1.25rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.15);
    }
    
    .invoice-info-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .invoice-info-label {
      font-size: 0.8rem;
      color: #94a3b8;
      margin-bottom: 0.5rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .invoice-info-value {
      font-size: 1.05rem;
      color: #e2e8f0;
      font-weight: 500;
      line-height: 1.6;
    }
    
    .invoice-info-value.vat-value {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.5rem;
    }
    
    .vat-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.75rem;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }
    
    .vat-badge.valid {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }
    
    .vat-badge.invalid {
      background: rgba(239, 68, 68, 0.2);
      color: #f87171;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }
    
    .vat-badge.unknown {
      background: rgba(148, 163, 184, 0.2);
      color: #94a3b8;
      border: 1px solid rgba(148, 163, 184, 0.3);
    }
    
    .financial-summary {
      border-top: 2px solid rgba(148, 163, 184, 0.2);
      padding-top: 1rem;
      margin-top: 1rem;
    }
    
    .financial-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding: 0.75rem 0;
      color: #cbd5e1;
      font-size: 1rem;
    }
    
    .financial-item span:first-child {
      font-weight: 500;
    }
    
    .financial-item span:last-child {
      font-weight: 600;
      font-family: 'Courier New', monospace;
    }
    
    .financial-total {
      font-size: 1.75rem;
      font-weight: 800;
      color: #60a5fa;
      padding-top: 1rem;
      margin-top: 0.5rem;
    }
    
    .financial-total span:first-child {
      font-size: 1.25rem;
    }
    
    .financial-total span:last-child {
      font-size: 1.75rem;
    }
    
    @media (max-width: 1024px) {
      .invoice-detail-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
      
      .invoice-preview-card {
        min-height: 500px;
        height: auto;
        max-height: 80vh;
      }
      
      .pdf-preview-container {
        min-height: 500px;
        max-height: calc(80vh - 100px);
      }
      
      .invoice-preview img {
        max-width: 100%;
        max-height: 70vh;
      }
    }
    
    @media (max-width: 768px) {
      .invoice-detail-modal {
        padding: 0.5rem;
      }
      
      .invoice-detail-content {
        padding: 1rem;
        border-radius: 12px;
      }
      
      .invoice-detail-close {
        width: 36px;
        height: 36px;
        font-size: 1.25rem;
        top: 0.75rem;
        right: 0.75rem;
      }
      
      .invoice-detail-card h3 {
        font-size: 1.1rem;
        margin-bottom: 0.75rem;
      }
      
      .invoice-detail-card {
        padding: 1rem;
      }
      
      .invoice-preview {
        margin-bottom: 0.75rem;
      }
      
      .invoice-preview img {
        max-width: 100%;
        max-height: 60vh;
      }
      
      .invoice-preview-card {
        min-height: 400px;
        max-height: 70vh;
      }
      
      .pdf-preview-container {
        min-height: 400px;
        max-height: calc(70vh - 100px);
      }
      
      .pdf-object,
      .pdf-iframe {
        min-height: 400px;
      }
      
      .invoice-line-items th,
      .invoice-line-items td {
        padding: 10px 12px;
        font-size: 0.85rem;
      }
      
      .invoice-line-items th {
        font-size: 0.75rem;
      }
      
      .invoice-info-label {
        font-size: 0.75rem;
      }
      
      .invoice-info-value {
        font-size: 0.95rem;
      }
      
      .financial-item {
        font-size: 0.9rem;
      }
      
      .financial-total {
        font-size: 1.5rem;
      }
      
      .financial-total span:first-child {
        font-size: 1.1rem;
      }
      
      .financial-total span:last-child {
        font-size: 1.5rem;
      }
      
      .vat-badge {
        font-size: 0.75rem;
        padding: 0.2rem 0.6rem;
      }
    }
    
    @media (max-width: 480px) {
      .invoice-detail-modal {
        padding: 0;
      }
      
      .invoice-detail-content {
        border-radius: 0;
        min-height: 100vh;
        padding: 0.75rem;
      }
      
      .invoice-preview-card {
        min-height: 300px;
        max-height: 60vh;
      }
      
      .pdf-preview-container {
        min-height: 300px;
        max-height: calc(60vh - 80px);
      }
      
      .pdf-object,
      .pdf-iframe {
        min-height: 300px;
      }
      
      .invoice-preview img {
        max-width: 100%;
        max-height: 50vh;
      }
      
      .invoice-line-items {
        min-width: 500px;
      }
      
      .invoice-line-items th,
      .invoice-line-items td {
        padding: 8px 10px;
        font-size: 0.8rem;
      }
    }
    
    /* Loading Indicator */
    .loading-indicator {
      display: none;
      text-align: center;
      padding: 2rem;
      color: #60a5fa;
    }
    
    .loading-indicator.active {
      display: block;
    }
    
    .loading-spinner {
      border: 3px solid rgba(96, 165, 250, 0.3);
      border-top: 3px solid #60a5fa;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Content Sections */
    .content-section {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 16px;
      padding: 2.5rem;
      margin-bottom: 2rem;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .content-section h2 {
      font-size: 2rem;
      margin-bottom: 1.5rem;
      color: #60a5fa;
    }
    
    .content-section h3 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      margin-top: 2rem;
      color: #a78bfa;
    }
    
    .content-section p {
      font-size: 1.1rem;
      line-height: 1.8;
      color: #cbd5e1;
      margin-bottom: 1.5rem;
    }
    
    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }
    
    .stat-card {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
    }
    
    .stat-card .stat-value {
      font-size: 2.5rem;
      font-weight: bold;
      color: #60a5fa;
      margin-bottom: 0.5rem;
    }
    
    .stat-card .stat-label {
      font-size: 1rem;
      color: #94a3b8;
    }
    
    /* Integration Cards */
    .integration-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }
    
    .integration-card {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 12px;
      padding: 1.25rem;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .integration-card:hover {
      border-color: rgba(96, 165, 250, 0.5);
      transform: translateY(-4px);
    }
    
    .integration-card h4 {
      color: #60a5fa;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }
    
    .integration-card p {
      font-size: 0.85rem;
      color: #94a3b8;
      margin: 0;
    }
    
    /* FAQ Section */
    .faq-section {
      max-width: 900px;
      margin: 4rem auto 3rem;
    }
    
    .faq-section h2 {
      font-size: 2rem;
      margin-bottom: 2rem;
      text-align: center;
      color: #60a5fa;
    }
    
    .faq-item {
      background: rgba(15, 23, 42, 0.6);
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      cursor: pointer;
      margin-bottom: 1rem;
    }
    
    .faq-item summary {
      font-size: 1.3rem;
      font-weight: 600;
      color: #60a5fa;
      margin-bottom: 1rem;
      cursor: pointer;
      list-style: none;
    }
    
    .faq-item summary::-webkit-details-marker {
      display: none;
    }
    
    .faq-item summary::before {
      content: '+ ';
      margin-right: 0.5rem;
      font-weight: bold;
    }
    
    .faq-item[open] summary::before {
      content: '‚àí ';
    }
    
    .faq-item p {
      font-size: 1.1rem;
      line-height: 1.8;
      color: #cbd5e1;
      margin-top: 1rem;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
      }
      
      .content-section {
        padding: 2rem;
      }
      
      .content-section h2 {
        font-size: 1.5rem;
      }
      
      .demo-grid {
        grid-template-columns: 1fr;
      }
      
      .results-header-container {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .results-header-buttons {
        width: 100%;
        flex-direction: column;
      }
      
      .results-header-buttons button {
        width: 100%;
      }
      
      #results-table {
        font-size: 0.85rem;
      }
      
      #results-table th,
      #results-table td {
        padding: 8px 12px;
      }
    }
  </style>
</head>
<body>
  <custom-navbar></custom-navbar>
  
  <div class="container">
    <header>
      <h1 data-i18n="invoice.title">Rechnungsdatenextraktion: KI-basierte Rechnungsverarbeitung</h1>
      <p class="subtitle" data-i18n="invoice.subtitle">Intelligente Automatisierung f√ºr Ihr Business</p>
    </header>
    
    <!-- Short Intro -->
    <div class="intro-section">
      <h2 data-i18n="invoice.problem.title">Das Problem: Zeitverschwendung bei manueller Rechnungsverarbeitung</h2>
      <p data-i18n="invoice.problem.p1">
        Jeden Monat stapeln sich Rechnungen auf dem Schreibtisch. Die manuelle Erfassung in Buchhaltungssysteme kostet wertvolle Arbeitszeit: Pro Rechnung ben√∂tigen Sie durchschnittlich 10-15 Minuten. Bei 100 Rechnungen pro Monat bedeutet das <strong>√ºber 20 Stunden reine Verwaltungszeit</strong>.
      </p>
      <p data-i18n="invoice.problem.p2">
        Unsere KI-basierte L√∂sung automatisiert diesen Prozess vollst√§ndig: Mit <strong>Gemini 2.5 Flash</strong> und einem flexiblen <strong>n8n Workflow</strong> extrahieren wir alle Rechnungsdaten automatisch ‚Äì Rechnungsnummer, Datum, Betrag, USt-IdNr., Lieferant und mehr. Das Ergebnis: Aus 10-15 Minuten pro Rechnung werden <strong>30 Sekunden</strong>.
      </p>
    </div>
    
    <!-- Demo Section - Direkt nach Problem-Absatz -->
    <h2 style="font-size: 2rem; margin-bottom: 2rem; text-align: center; color: #60a5fa; margin-top: 3rem;" data-i18n="invoice.demo.title">Live-Demo: Rechnungsdatenextraktion jetzt testen</h2>
    
    <!-- Demo Invoices Grid -->
    <div class="demo-grid">
      <!-- Demo Invoice 1 -->
      <a href="#" class="demo-card-link" data-invoice-sample="1">
        <div class="demo-card">
          <img src="https://koretex-invoice-db.onrender.com/samples/rechnung-1.jpg" 
               alt="Demo Rechnung 1 - Deutsche Rechnung (JPG)"
               style="max-height: 200px; object-fit: contain;"
               onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzMzMzMzMyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZSBub3QgYXZhaWxhYmxlPC90ZXh0Pjwvc3ZnPg=='; console.error('‚ùå Failed to load image:', this.src);">
          <h3>Rechnungsvorlage 1</h3>
          <p>Klicke auf diese Demo-Rechnung ‚Üí KI extrahiert automatisch Rechnungsnummer, Datum, Betrag, USt-IdNr. ‚Üí Ergebnis erscheint in der Tabelle.</p>
          <div class="demo-tags">
            <span class="tag">‚ö° 30 Sek</span>
            <span class="tag success">‚úÖ 95% Genauigkeit</span>
            <span class="tag">üîó KI-Powered</span>
          </div>
          <span class="arrow-icon">‚Üí</span>
        </div>
      </a>
      
      <!-- Demo Invoice 2 -->
      <a href="#" class="demo-card-link" data-invoice-sample="2">
        <div class="demo-card">
          <img src="https://koretex-invoice-db.onrender.com/samples/rechnung-2.jpg" 
               alt="Demo Rechnung 2 - Deutsche Rechnung (JPG)"
               style="max-height: 200px; object-fit: contain;"
               onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzMzMzMzMyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZSBub3QgYXZhaWxhYmxlPC90ZXh0Pjwvc3ZnPg=='; console.error('‚ùå Failed to load image:', this.src);">
          <h3>Rechnungsvorlage 2</h3>
          <p>Klicke auf diese Demo-Rechnung ‚Üí KI extrahiert automatisch alle Rechnungsdaten ‚Üí Ergebnis erscheint in der Tabelle.</p>
          <div class="demo-tags">
            <span class="tag">‚ö° 30 Sek</span>
            <span class="tag success">‚úÖ 95% Genauigkeit</span>
            <span class="tag">üîó KI-Powered</span>
          </div>
          <span class="arrow-icon">‚Üí</span>
        </div>
      </a>
      
      <!-- Demo Invoice 3 -->
      <a href="#" class="demo-card-link" data-invoice-sample="3">
        <div class="demo-card">
          <div style="text-align: center; padding: 2rem; background: rgba(96, 165, 250, 0.1); border-radius: 12px; margin-bottom: 1rem; min-height: 200px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
            <iframe 
              src="https://koretex-invoice-db.onrender.com/samples/rechnung-3.pdf#toolbar=0&view=FitH" 
              style="width: 100%; height: 180px; border: 2px solid rgba(148, 163, 184, 0.3); border-radius: 8px; background: white;"
              onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=\'font-size: 3rem;\'>üìÑ</span><p style=\'margin-top: 0.5rem; color: #60a5fa; font-weight: 600;\'>PDF Rechnung</p>';">
            </iframe>
            <p style="margin-top: 0.5rem; color: #60a5fa; font-weight: 600; font-size: 0.9rem;">PDF Rechnung</p>
          </div>
          <h3>Rechnung Vorlage 1 (ENG)</h3>
          <p>Klicke auf diese Demo-Rechnung ‚Üí KI extrahiert automatisch alle Rechnungsdaten aus PDF ‚Üí Ergebnis erscheint in der Tabelle.</p>
          <div class="demo-tags">
            <span class="tag">‚ö° 30 Sek</span>
            <span class="tag success">‚úÖ 95% Genauigkeit</span>
            <span class="tag">üîó KI-Powered</span>
          </div>
          <span class="arrow-icon">‚Üí</span>
        </div>
      </a>
      
      <!-- Demo Invoice 4 -->
      <a href="#" class="demo-card-link" data-invoice-sample="4">
        <div class="demo-card">
          <div style="text-align: center; padding: 2rem; background: rgba(96, 165, 250, 0.1); border-radius: 12px; margin-bottom: 1rem; min-height: 200px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
            <iframe 
              src="https://koretex-invoice-db.onrender.com/samples/rechnung-4.pdf#toolbar=0&view=FitH" 
              style="width: 100%; height: 180px; border: 2px solid rgba(148, 163, 184, 0.3); border-radius: 8px; background: white;"
              onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=\'font-size: 3rem;\'>üìÑ</span><p style=\'margin-top: 0.5rem; color: #60a5fa; font-weight: 600;\'>PDF Rechnung</p>';">
            </iframe>
            <p style="margin-top: 0.5rem; color: #60a5fa; font-weight: 600; font-size: 0.9rem;">PDF Rechnung</p>
          </div>
          <h3>Rechnung Vorlage 2 (DE)</h3>
          <p>Klicke auf diese Demo-Rechnung ‚Üí KI extrahiert automatisch alle Rechnungsdaten aus PDF ‚Üí Ergebnis erscheint in der Tabelle.</p>
          <div class="demo-tags">
            <span class="tag">‚ö° 30 Sek</span>
            <span class="tag success">‚úÖ 95% Genauigkeit</span>
            <span class="tag">üîó KI-Powered</span>
          </div>
          <span class="arrow-icon">‚Üí</span>
        </div>
      </a>
      
      <!-- Upload Card -->
      <label for="invoice-upload-input" class="demo-card-link" style="cursor: pointer;">
        <div class="demo-card">
          <span class="demo-icon">üì§</span>
          <h3>Eigene Rechnung hochladen</h3>
          <p>Klicke hier ‚Üí W√§hle deine Rechnung (JPG, PNG, PDF) ‚Üí KI extrahiert ‚Üí Ergebnis erscheint in der Tabelle unten.</p>
          <div class="demo-tags">
            <span class="tag">üîí DSGVO</span>
            <span class="tag success">üì• Upload</span>
            <span class="tag">üß† KI</span>
          </div>
          <span class="arrow-icon">‚Üí</span>
        </div>
      </label>
      <input type="file" id="invoice-upload-input" accept="image/jpeg,image/png,image/jpg,application/pdf" style="display: none;">
    </div>
    
    <!-- Loading Indicator -->
    <div id="loading-indicator" class="loading-indicator">
      <div class="loading-spinner"></div>
      <p>Rechnung wird verarbeitet...</p>
    </div>
    
    <!-- Invoice Detail Modal -->
    <div id="invoice-detail-modal" class="invoice-detail-modal">
      <div class="invoice-detail-content">
        <button class="invoice-detail-close" onclick="closeInvoiceDetail()" aria-label="Schlie√üen">√ó</button>
        <div id="invoice-detail-body"></div>
      </div>
    </div>
    
    <!-- Results Section -->
    <div class="results-section">
      <div class="results-header-container">
        <div style="font-weight: 600;" data-i18n="invoice.results.title">Extrahierte Rechnungsdaten <span id="results-count" style="font-weight: normal; color: #94a3b8; font-size: 0.9em; margin-left: 0.5rem;">(0)</span></div>
        <div class="results-header-buttons">
          <button id="btn-clear-results" class="danger" data-i18n="invoice.results.clear">üóëÔ∏è L√∂schen</button>
          <button id="btn-download-csv" data-i18n="invoice.results.downloadCsv">üì• CSV herunterladen</button>
          <button id="btn-download-json" data-i18n="invoice.results.downloadJson">üì• JSON herunterladen</button>
        </div>
      </div>
      <div style="overflow-x: auto;">
        <table id="results-table">
          <thead>
            <tr>
              <th data-i18n="invoice.table.invoiceNumber">Rechnungsnummer</th>
              <th data-i18n="invoice.table.date">Datum</th>
              <th data-i18n="invoice.table.supplier">Lieferant</th>
              <th data-i18n="invoice.table.vatId">USt-IdNr.</th>
              <th data-i18n="invoice.table.total">Gesamtbetrag</th>
              <th data-i18n="invoice.table.status">Status</th>
              <th data-i18n="invoice.table.time">Zeit</th>
            </tr>
          </thead>
          <tbody id="results-tbody">
            <tr>
              <td colspan="7" style="padding:16px; color:#94a3b8; text-align: center;" data-i18n="invoice.results.empty">Noch keine Ergebnisse. Starte eine Demo oben.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Stats Section -->
    <div class="content-section">
      <h2 data-i18n="invoice.stats.title">Messbare Ergebnisse & ROI</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value">93%</div>
          <div class="stat-label" data-i18n="invoice.stats.timeSaved">Zeitersparnis</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">95%</div>
          <div class="stat-label" data-i18n="invoice.stats.accuracy">Erkennungsgenauigkeit</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">20h</div>
          <div class="stat-label" data-i18n="invoice.stats.hoursGained">Gewonnene Stunden/Monat</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">30s</div>
          <div class="stat-label" data-i18n="invoice.stats.perInvoice">Pro Rechnung</div>
        </div>
      </div>
      
      <h3 data-i18n="invoice.stats.timeSaved">Zeitersparnis</h3>
      <p data-i18n="invoice.stats.timeSavedDesc">
        <strong>Bis zu 20 Arbeitsstunden pro Monat</strong> bei durchschnittlich 100 Rechnungen. Aus 10-15 Minuten pro Rechnung werden 30 Sekunden ‚Äì eine <strong>Zeitersparnis von 93%</strong>.
      </p>
      
      <h3 data-i18n="invoice.stats.accuracy">Erkennungsgenauigkeit</h3>
      <p data-i18n="invoice.stats.accuracyDesc">
        <strong>95% Erkennungsgenauigkeit</strong> dank modernster KI-Modelle. Automatische Validierung von USt-IdNr., Betr√§gen und Rechnungsnummern reduziert Fehlerquoten auf ein Minimum.
      </p>
      
      <h3>Kostenreduktion</h3>
      <p data-i18n="invoice.stats.costDesc">
        Bei einem Stundensatz von 50‚Ç¨ sparen Sie <strong>monatlich bis zu 1.000‚Ç¨ Verwaltungskosten</strong>. Die Amortisation erfolgt bereits im ersten Monat.
      </p>
    </div>
    
    <!-- Integration Section -->
    <div class="content-section">
      <h2 data-i18n="invoice.integration.title">Einfache Integration in Ihre bestehende IT</h2>
      <p data-i18n="invoice.integration.p1">
        Der n8n Workflow kann flexibel in Ihre bestehende IT-Infrastruktur integriert werden:
      </p>
      
      <div class="integration-grid">
        <div class="integration-card">
          <h4>üì• Webhook</h4>
          <p data-i18n="invoice.integration.webhook">Direkter Datentransfer in Echtzeit</p>
        </div>
        <div class="integration-card">
          <h4>üìä CSV/JSON</h4>
          <p data-i18n="invoice.integration.csv">Export f√ºr manuellen Import</p>
        </div>
        <div class="integration-card">
          <h4>üîó REST-API</h4>
          <p data-i18n="invoice.integration.api">Vollautomatische Synchronisation</p>
        </div>
        <div class="integration-card">
          <h4>üíº DATEV</h4>
          <p data-i18n="invoice.integration.datev">Direkte Integration m√∂glich</p>
        </div>
        <div class="integration-card">
          <h4>üìã Lexware</h4>
          <p data-i18n="invoice.integration.lexware">CSV-Import unterst√ºtzt</p>
        </div>
        <div class="integration-card">
          <h4>üè¢ SAP</h4>
          <p data-i18n="invoice.integration.sap">API-Anbindung m√∂glich</p>
        </div>
      </div>
      
      <p data-i18n="invoice.integration.p2">
        Exportm√∂glichkeiten in <strong>CSV und JSON</strong> erm√∂glichen nahtlose Integration in bestehende Buchhaltungssysteme wie DATEV, Lexware oder SAP. Die Datenqualit√§t wird durch mehrstufige Validierungsprozesse garantiert.
      </p>
    </div>
    
    <!-- DSGVO Section -->
    <div class="content-section">
      <h2 data-i18n="invoice.gdpr.title">DSGVO-Konformit√§t: Datenverarbeitung nach europ√§ischen Standards</h2>
      <p data-i18n="invoice.gdpr.p1">
        Alle Server befinden sich in Deutschland oder der EU, sodass die Datenverarbeitung vollst√§ndig den Anforderungen der <strong>DSGVO (Datenschutz-Grundverordnung)</strong> entspricht. Nach erfolgreicher Extraktion werden die hochgeladenen Rechnungen automatisch nach 10 Minuten gel√∂scht ‚Äì keine dauerhafte Speicherung von personenbezogenen Daten.
      </p>
      <p data-i18n="invoice.gdpr.p2">
        Der n8n Workflow kann optional als <strong>Self-Hosted-L√∂sung</strong> in Ihrer eigenen Infrastruktur betrieben werden, falls zus√§tzliche Sicherheitsanforderungen bestehen.
      </p>
    </div>
    
    <!-- Technology Section -->
    <div class="content-section">
      <h2 data-i18n="invoice.tech.title">Technologie: Warum n8n & Gemini 2.5 Flash?</h2>
      <p data-i18n="invoice.tech.p1">
        <strong>n8n</strong> ist die ideale Basis f√ºr diesen Workflow: Die Open-Source-Automatisierungsplattform bietet maximale Flexibilit√§t f√ºr individuelle Anpassungen und kann als Self-Hosted-L√∂sung in Ihrer eigenen IT-Infrastruktur betrieben werden. F√ºr die Texterkennung nutzen wir <strong>Google Gemini 2.5 Flash</strong> ‚Äì ein modernes KI-Modell, das hohe Erkennungsgenauigkeit mit schneller Verarbeitung kombiniert.
      </p>
    </div>
    
    <!-- FAQ Section -->
    <div class="faq-section">
      <h2 data-i18n="invoice.faq.title">H√§ufige Fragen (FAQ)</h2>
      
      <details class="faq-item">
        <summary data-i18n="invoice.faq.q1">Welche KI-Modelle werden f√ºr die Rechnungsdatenextraktion genutzt?</summary>
        <p data-i18n="invoice.faq.a1">
          Wir nutzen <strong>Google Gemini 2.5 Flash</strong> √ºber die Vertex AI API. Dieses moderne KI-Modell kombiniert hohe Erkennungsgenauigkeit (95%) mit schneller Verarbeitung. Die Texterkennung erfolgt vollst√§ndig automatisch ‚Äì von gedruckten Rechnungen bis hin zu gescannten PDFs.
        </p>
      </details>
      
      <details class="faq-item">
        <summary data-i18n="invoice.faq.q2">Wie wird der n8n-Workflow in unsere bestehende IT (z.B. Buchhaltung) integriert?</summary>
        <p data-i18n="invoice.faq.a2">
          Der n8n Workflow kann √ºber verschiedene Wege integriert werden: <strong>Webhook-Integration</strong> f√ºr direkten Datentransfer, <strong>CSV/JSON-Export</strong> f√ºr manuellen Import in Buchhaltungssysteme wie DATEV, Lexware oder SAP, oder <strong>REST-API-Anbindung</strong> f√ºr vollautomatische Synchronisation. Unsere L√∂sung passt sich flexibel an Ihre bestehende IT-Infrastruktur an.
        </p>
      </details>
      
      <details class="faq-item">
        <summary data-i18n="invoice.faq.q3">Ist die Erkennungsgenauigkeit von 95% garantiert?</summary>
        <p data-i18n="invoice.faq.a3">
          Die <strong>95% Erkennungsgenauigkeit</strong> basiert auf durchschnittlichen Werten bei guter Bildqualit√§t (mindestens 300 DPI, klar lesbare Schrift). Bei optimalen Bedingungen erreichen wir bis zu 98% Genauigkeit. Bei verschwommenen Bildern oder schlechter Scan-Qualit√§t kann die Genauigkeit geringer ausfallen. Alle extrahierten Daten werden automatisch validiert (USt-IdNr., Betr√§ge, Rechnungsnummern) um Fehlerquoten zu minimieren.
        </p>
      </details>
      
      <details class="faq-item">
        <summary data-i18n="invoice.faq.q4">Welche Datenformate (CSV, JSON) werden unterst√ºtzt?</summary>
        <p data-i18n="invoice.faq.a4">
          Wir unterst√ºtzen <strong>CSV-Export</strong> (kompatibel mit Excel, Google Sheets, alle Buchhaltungssysteme) und <strong>JSON-Export</strong> f√ºr programmatische Integration. Der CSV-Export enth√§lt alle Felder (Rechnungsnummer, Datum, Betrag, USt-IdNr., Lieferant, etc.) und kann direkt in Ihre Buchhaltungssysteme importiert werden.
        </p>
      </details>
      
      <details class="faq-item">
        <summary data-i18n="invoice.faq.q5">Wie lange dauert die Verarbeitung einer Rechnung?</summary>
        <p data-i18n="invoice.faq.a5">
          Die Verarbeitung einer einzelnen Rechnung dauert durchschnittlich <strong>30 Sekunden</strong> ‚Äì von Upload bis zu vollst√§ndig extrahierten Rechnungsdaten. Dies umfasst Bild-Upload, KI-Analyse, Datenextraktion und Validierung. Im Vergleich zur manuellen Erfassung (durchschnittlich 10-15 Minuten pro Rechnung) sparen Sie <strong>93% der Zeit</strong>.
        </p>
      </details>
    </div>
  </div>
  
  <custom-footer></custom-footer>
  
  <script src="./components/navbar.js"></script>
  <script src="./components/footer.js"></script>
  <script src="./components/cookie-banner.js"></script>
  <script src="script.js"></script>
  <script>
    // Invoice Extractor API Base URL
    const API_BASE_URL = 'https://koretex-invoice-db.onrender.com';
    
    // Store extracted invoices
    const extractedInvoices = [];
    
    // Store full invoice details (for detail view)
    const invoiceDetails = new Map();
    
    // Sample invoice URLs
    const sampleInvoices = {
      1: { url: '/samples/rechnung-1.jpg', name: 'Rechnungsvorlage 1.jpg', type: 'image/jpeg' },
      2: { url: '/samples/rechnung-2.jpg', name: 'Rechnungsvorlage 2.jpg', type: 'image/jpeg' },
      3: { url: '/samples/rechnung-3.pdf', name: 'Rechnung Vorlage 1 (ENG).pdf', type: 'application/pdf' },
      4: { url: '/samples/rechnung-3.pdf', name: 'Rechnung Vorlage 2 (DE).pdf', type: 'application/pdf' }
    };
    
    // Show loading indicator
    function showLoading() {
      const loading = document.getElementById('loading-indicator');
      if (loading) {
        loading.classList.add('active');
      }
    }
    
    // Hide loading indicator
    function hideLoading() {
      const loading = document.getElementById('loading-indicator');
      if (loading) {
        loading.classList.remove('active');
      }
    }
    
    // Upload invoice file
    async function uploadInvoice(file) {
      showLoading();
      
      try {
        const formData = new FormData();
        formData.append('file', file);
        
        const response = await fetch(`${API_BASE_URL}/api/invoices/upload`, {
          method: 'POST',
          body: formData,
          credentials: 'include'
        });
        
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(errorText || 'Upload fehlgeschlagen');
        }
        
        const invoice = await response.json();
        console.log('‚úÖ Invoice uploaded and processed:', invoice);
        console.log('üìä Invoice status:', invoice.status);
        console.log('üìä Invoice data:', {
          invoiceNumber: invoice.invoiceNumber,
          invoiceDate: invoice.invoiceDate,
          supplierName: invoice.supplierName,
          totalAmount: invoice.totalAmount,
          errorMessage: invoice.errorMessage
        });
        
        // Store full invoice details
        invoiceDetails.set(invoice.id, invoice);
        
        // Add to extracted invoices
        extractedInvoices.unshift({
          id: invoice.id,
          invoiceNumber: invoice.invoiceNumber || '',
          invoiceDate: invoice.invoiceDate || '',
          supplierName: invoice.supplierName || '',
          supplierVatId: invoice.supplierVatId || '',
          totalAmount: invoice.totalAmount || '',
          status: invoice.status || 'processing',
          createdAt: invoice.createdAt || new Date().toISOString(),
          source: 'Upload'
        });
        
        renderResults();
        scrollToResults();
        
        // Check if there's an error
        if (invoice.status === 'error') {
          console.error('‚ùå Invoice processing failed:', invoice.errorMessage);
          alert(`Fehler bei der Verarbeitung: ${invoice.errorMessage || 'Unbekannter Fehler'}`);
          return invoice;
        }
        
        // If invoice is completed immediately, show detail view automatically
        if (invoice.status === 'completed') {
          console.log('‚úÖ Invoice completed immediately');
          // Small delay to let the UI update first
          setTimeout(() => {
            showInvoiceDetail(invoice.id);
          }, 500);
        }
        
        // If status is processing, poll for completion
        if (invoice.status === 'processing') {
          console.log('‚è≥ Invoice is processing, starting polling...');
          pollInvoiceStatus(invoice.id);
        }
        
        return invoice;
      } catch (error) {
        console.error('‚ùå Error uploading invoice:', error);
        console.error('Error details:', {
          message: error.message,
          name: error.name,
          stack: error.stack
        });
        
        let userMessage = 'Fehler beim Hochladen der Rechnung: ' + (error.message || 'Unbekannter Fehler');
        
        // More specific error messages
        if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {
          userMessage = 'Netzwerk-Fehler: Die API ist nicht erreichbar. Bitte versuchen Sie es sp√§ter erneut.';
        } else if (error.message.includes('400')) {
          userMessage = 'Ung√ºltige Datei: Bitte stellen Sie sicher, dass die Datei ein g√ºltiges JPG, PNG oder PDF ist.';
        } else if (error.message.includes('413')) {
          userMessage = 'Datei zu gro√ü: Die Datei √ºberschreitet das Maximum von 10 MB.';
        } else if (error.message.includes('500')) {
          userMessage = 'Server-Fehler: Die Verarbeitung ist fehlgeschlagen. Bitte versuchen Sie es sp√§ter erneut.';
        }
        
        alert(userMessage);
        throw error;
      } finally {
        hideLoading();
      }
    }
    
    // Poll invoice status until completed
    async function pollInvoiceStatus(invoiceId) {
      const maxAttempts = 60; // 60 seconds max (KI-Extraktion kann l√§nger dauern)
      let attempts = 0;
      
      const poll = async () => {
        try {
          attempts++;
          console.log(`üîÑ Polling invoice status (attempt ${attempts}/${maxAttempts}):`, invoiceId);
          
          const response = await fetch(`${API_BASE_URL}/api/invoices/${invoiceId}`, {
            credentials: 'include'
          });
          
          if (!response.ok) {
            throw new Error(`Failed to fetch invoice status: ${response.status} ${response.statusText}`);
          }
          
          const invoice = await response.json();
          console.log(`üìä Invoice status update (attempt ${attempts}):`, {
            status: invoice.status,
            invoiceNumber: invoice.invoiceNumber,
            supplierName: invoice.supplierName,
            errorMessage: invoice.errorMessage
          });
          
          // Store full invoice details
          invoiceDetails.set(invoice.id, invoice);
          
          // Update invoice in extractedInvoices
          const index = extractedInvoices.findIndex(inv => inv.id === invoiceId);
          if (index !== -1) {
            const oldStatus = extractedInvoices[index].status;
            
            extractedInvoices[index] = {
              id: invoice.id,
              invoiceNumber: invoice.invoiceNumber || '',
              invoiceDate: invoice.invoiceDate || '',
              supplierName: invoice.supplierName || '',
              supplierVatId: invoice.supplierVatId || '',
              totalAmount: invoice.totalAmount || '',
              status: invoice.status || 'processing',
              createdAt: invoice.createdAt || new Date().toISOString(),
              source: extractedInvoices[index].source || 'Upload'
            };
            renderResults();
            
            // Check for errors
            if (invoice.status === 'error') {
              console.error('‚ùå Invoice processing failed:', invoice.errorMessage);
              alert(`Fehler bei der Verarbeitung: ${invoice.errorMessage || 'Unbekannter Fehler'}`);
              return; // Stop polling
            }
            
            // If invoice just completed (status changed from processing to completed), show detail view
            if (invoice.status === 'completed' && oldStatus === 'processing') {
              console.log('‚úÖ Invoice completed! Showing detail view...');
              // Show detail view when invoice completes
              setTimeout(() => {
                showInvoiceDetail(invoice.id);
              }, 500);
              return; // Stop polling
            }
          }
          
          // Continue polling if still processing and not exceeded max attempts
          if (invoice.status === 'processing' && attempts < maxAttempts) {
            setTimeout(poll, 1000); // Poll every second
          } else if (attempts >= maxAttempts) {
            console.warn('‚ö†Ô∏è Max polling attempts reached. Invoice may still be processing.');
            alert('Die Verarbeitung dauert l√§nger als erwartet. Bitte laden Sie die Seite neu, um den Status zu pr√ºfen.');
          }
        } catch (error) {
          console.error('‚ùå Error polling invoice status:', error);
          console.error('Error details:', {
            message: error.message,
            name: error.name,
            invoiceId: invoiceId,
            attempt: attempts
          });
          
          // Only stop polling after 3 consecutive errors
          if (attempts >= 3) {
            console.error('‚ùå Too many polling errors. Stopping.');
            alert('Fehler beim Abrufen des Verarbeitungsstatus. Bitte laden Sie die Seite neu.');
            return;
          }
          
          // Retry after error
          setTimeout(poll, 2000); // Wait 2 seconds before retry
        }
      };
      
      poll();
    }
    
    // Load sample invoice
    async function loadSampleInvoice(sampleId) {
      const sample = sampleInvoices[sampleId];
      if (!sample) {
        console.error('‚ùå Sample invoice not found:', sampleId);
        alert('‚ùå Demo-Rechnung nicht gefunden. Bitte versuchen Sie es erneut.');
        return;
      }
      
      console.log('üì• Loading sample invoice:', sample.name, 'from', `${API_BASE_URL}${sample.url}`);
      showLoading();
      
      try {
        // Fetch the sample file from the API
        const sampleUrl = `${API_BASE_URL}${sample.url}`;
        console.log('üåê Fetching from:', sampleUrl);
        
        const response = await fetch(sampleUrl, {
          method: 'GET',
          credentials: 'include'
        });
        
        if (!response.ok) {
          const errorText = await response.text();
          console.error('‚ùå Fetch failed:', response.status, response.statusText, errorText);
          throw new Error(`Fehler beim Laden der Demo-Rechnung (${response.status}): ${response.statusText}`);
        }
        
        const blob = await response.blob();
        console.log('‚úÖ Sample file loaded:', blob.size, 'bytes', blob.type);
        
        // Validate blob type and size
        if (blob.size === 0) {
          throw new Error('Die Datei ist leer (0 bytes). Bitte versuchen Sie es sp√§ter erneut.');
        }
        
        if (blob.size > 10 * 1024 * 1024) {
          throw new Error(`Die Datei ist zu gro√ü (${(blob.size / 1024 / 1024).toFixed(2)} MB). Maximum: 10 MB.`);
        }
        
        // Validate blob type
        const expectedType = sample.type;
        const actualType = blob.type;
        
        // For images, blob.type might be empty, so use the expected type
        const finalType = actualType || expectedType;
        
        if (!finalType || (!finalType.startsWith('image/') && finalType !== 'application/pdf')) {
          console.warn('‚ö†Ô∏è Unexpected blob type:', actualType, 'expected:', expectedType, '- using expected type');
        }
        
        const file = new File([blob], sample.name, { type: finalType });
        console.log('üìÑ Created file object:', file.name, file.type, file.size, 'bytes');
        
        // Validate file object
        if (!file || file.size === 0) {
          throw new Error('Fehler beim Erstellen der Datei. Bitte versuchen Sie es erneut.');
        }
        
        // Upload the sample file
        console.log('üì§ Uploading sample file to API...');
        await uploadInvoice(file);
      } catch (error) {
        console.error('‚ùå Error loading sample invoice:', error);
        const errorMessage = error.message || 'Unbekannter Fehler';
        const errorName = error.name || '';
        
        // Check if it's a CORS error or network error
        if (errorMessage.includes('CORS') || errorMessage.includes('Failed to fetch') || errorName === 'TypeError' || errorMessage.includes('ERR_FAILED')) {
          alert(`Fehler beim Laden der Demo-Rechnung: Die API ist momentan nicht erreichbar (CORS/Netzwerk-Fehler).\n\nBitte versuchen Sie es sp√§ter erneut.\n\nTipp: Stellen Sie sicher, dass die Invoice-Extractor API auf Render l√§uft.`);
        } else {
          alert(`Fehler beim Laden der Demo-Rechnung: ${errorMessage}\n\nBitte stellen Sie sicher, dass die Invoice-Extractor API erreichbar ist.`);
        }
        hideLoading();
      }
    }
    
    // Render results table
    function renderResults() {
      const tbody = document.getElementById('results-tbody');
      const countElement = document.getElementById('results-count');
      
      if (!tbody) return;
      
      // Update count
      if (countElement) {
        countElement.textContent = `(${extractedInvoices.length})`;
      }
      
      if (extractedInvoices.length === 0) {
        const emptyText = window.i18n?.t('invoice.results.empty') || 'Noch keine Ergebnisse. Starte eine Demo oben.';
        tbody.innerHTML = `<tr><td colspan="7" style="padding:16px; color:#94a3b8; text-align: center;">${emptyText}</td></tr>`;
        return;
      }
      
      tbody.innerHTML = extractedInvoices.map(inv => {
        const statusColor = inv.status === 'completed' ? '#4ade80' : inv.status === 'error' ? '#ef4444' : '#fbbf24';
        const statusText = inv.status === 'completed' ? '‚úÖ Abgeschlossen' : inv.status === 'error' ? '‚ùå Fehler' : '‚è≥ Verarbeitung...';
        const date = inv.invoiceDate || '-';
        const total = inv.totalAmount ? `‚Ç¨ ${parseFloat(inv.totalAmount).toFixed(2)}` : '-';
        const createdAt = new Date(inv.createdAt).toLocaleString('de-DE');
        const hasDetails = invoiceDetails.has(inv.id) && inv.status === 'completed';
        const detailClass = hasDetails ? 'invoice-row-clickable' : '';
        const detailStyle = hasDetails ? 'cursor: pointer;' : '';
        
        return `
          <tr class="${detailClass}" data-invoice-id="${inv.id}" style="${detailStyle}">
            <td>${escapeHtml(inv.invoiceNumber || '-')}</td>
            <td>${escapeHtml(date)}</td>
            <td>${escapeHtml(inv.supplierName || '-')}</td>
            <td>${escapeHtml(inv.supplierVatId || '-')}</td>
            <td>${escapeHtml(total)}</td>
            <td style="color: ${statusColor};">${statusText}</td>
            <td>${escapeHtml(createdAt)}${hasDetails ? ' <span style="color: #60a5fa; margin-left: 0.5rem;">üëÅÔ∏è Details</span>' : ''}</td>
          </tr>
        `;
      }).join('');
      
      // Add click handlers for invoice rows
      document.querySelectorAll('.invoice-row-clickable').forEach(row => {
        row.addEventListener('click', () => {
          const invoiceId = row.getAttribute('data-invoice-id');
          if (invoiceId) {
            showInvoiceDetail(invoiceId);
          }
        });
      });
    }
    
    // Clear all results
    function clearAllResults() {
      if (extractedInvoices.length === 0) return;
      
      const confirmText = window.i18n?.t('invoice.results.confirm') || 'M√∂chten Sie wirklich alle extrahierten Rechnungsdaten l√∂schen?';
      if (!confirm(confirmText)) return;
      
      extractedInvoices.length = 0;
      renderResults();
      console.log('üóëÔ∏è Alle Rechnungsdaten wurden gel√∂scht');
    }
    
    // Download CSV
    async function downloadCSV() {
      if (extractedInvoices.length === 0) {
        alert('Keine Daten zum Exportieren vorhanden.');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/invoices/export?format=csv`, {
          credentials: 'include'
        });
        
        if (!response.ok) {
          throw new Error('Export fehlgeschlagen');
        }
        
        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'rechnungen-export.csv';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      } catch (error) {
        console.error('‚ùå Error downloading CSV:', error);
        alert('Fehler beim Exportieren: ' + error.message);
      }
    }
    
    // Download JSON
    async function downloadJSON() {
      if (extractedInvoices.length === 0) {
        alert('Keine Daten zum Exportieren vorhanden.');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/invoices/export?format=json`, {
          credentials: 'include'
        });
        
        if (!response.ok) {
          throw new Error('Export fehlgeschlagen');
        }
        
        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'rechnungen-export.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      } catch (error) {
        console.error('‚ùå Error downloading JSON:', error);
        alert('Fehler beim Exportieren: ' + error.message);
      }
    }
    
    // Scroll to results
    function scrollToResults() {
      const resultsSection = document.querySelector('.results-section');
      if (resultsSection) {
        resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }
    
    // Escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // Show invoice detail view
    async function showInvoiceDetail(invoiceId) {
      let invoice = invoiceDetails.get(invoiceId);
      
      // If not in cache, fetch from API
      if (!invoice) {
        try {
          const response = await fetch(`${API_BASE_URL}/api/invoices/${invoiceId}`, {
            credentials: 'include'
          });
          if (!response.ok) {
            throw new Error('Rechnung nicht gefunden');
          }
          invoice = await response.json();
          invoiceDetails.set(invoiceId, invoice);
        } catch (error) {
          console.error('‚ùå Error fetching invoice details:', error);
          alert('Fehler beim Laden der Rechnungsdetails: ' + error.message);
          return;
        }
      }
      
      const modal = document.getElementById('invoice-detail-modal');
      const body = document.getElementById('invoice-detail-body');
      
      if (!modal || !body) return;
      
      // Build detail view HTML
      let html = `
        <h2 style="font-size: 1.75rem; margin-bottom: 0.5rem; color: #60a5fa;">
          ${escapeHtml(invoice.invoiceNumber || 'Rechnung Details')}
        </h2>
        <p style="color: #94a3b8; margin-bottom: 2rem;">${escapeHtml(invoice.fileName)}</p>
        
        <div class="invoice-detail-grid">
          <!-- Left Column: Invoice Info, Financial Summary & Line Items -->
          <div>
            <!-- Invoice Information -->
            <div class="invoice-detail-card">
              <h3>Rechnungsinformationen</h3>
              ${invoice.invoiceNumber ? `
                <div class="invoice-info-item">
                  <div class="invoice-info-label">Rechnungsnummer</div>
                  <div class="invoice-info-value">${escapeHtml(invoice.invoiceNumber)}</div>
                </div>
              ` : ''}
              ${invoice.invoiceDate ? `
                <div class="invoice-info-item">
                  <div class="invoice-info-label">Datum</div>
                  <div class="invoice-info-value">${escapeHtml(invoice.invoiceDate)}</div>
                </div>
              ` : ''}
              ${invoice.supplierName ? `
                <div class="invoice-info-item">
                  <div class="invoice-info-label">Lieferant</div>
                  <div class="invoice-info-value">${escapeHtml(invoice.supplierName)}</div>
                </div>
              ` : ''}
              ${invoice.supplierAddress ? `
                <div class="invoice-info-item">
                  <div class="invoice-info-label">Adresse</div>
                  <div class="invoice-info-value" style="font-size: 0.9rem; white-space: pre-line;">${escapeHtml(invoice.supplierAddress)}</div>
                </div>
              ` : ''}
              ${invoice.supplierVatId ? `
                <div class="invoice-info-item">
                  <div class="invoice-info-label">USt-IdNr.</div>
                  <div class="invoice-info-value vat-value" style="font-family: 'Courier New', monospace;">
                    <span>${escapeHtml(invoice.supplierVatId)}</span>
                    ${invoice.vatValidated === 'valid' 
                      ? '<span class="vat-badge valid">‚úÖ G√ºltig</span>'
                      : invoice.vatValidated === 'invalid'
                      ? '<span class="vat-badge invalid">‚ùå Ung√ºltig</span>'
                      : '<span class="vat-badge unknown">‚ÑπÔ∏è Nicht gepr√ºft</span>'
                    }
                  </div>
                </div>
              ` : ''}
            </div>
            
            <!-- Financial Summary -->
            <div class="invoice-detail-card" style="margin-top: 1.5rem;">
              <h3>Finanz√ºbersicht</h3>
              ${invoice.subtotal ? `
                <div class="financial-item">
                  <span>Zwischensumme</span>
                  <span>‚Ç¨ ${parseFloat(invoice.subtotal).toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                </div>
              ` : ''}
              ${invoice.vatRate && invoice.vatAmount ? `
                <div class="financial-item">
                  <span>MwSt. (${escapeHtml(invoice.vatRate)}%)</span>
                  <span>‚Ç¨ ${parseFloat(invoice.vatAmount).toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                </div>
              ` : ''}
              ${invoice.totalAmount ? `
                <div class="financial-summary">
                  <div class="financial-item financial-total">
                    <span>Gesamtsumme</span>
                    <span>‚Ç¨ ${parseFloat(invoice.totalAmount).toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                  </div>
                </div>
              ` : ''}
            </div>
            
            <!-- Line Items -->
            ${invoice.lineItems && invoice.lineItems.length > 0 ? `
            <div class="invoice-detail-card" style="margin-top: 1.5rem;">
              <h3>Rechnungspositionen</h3>
              <div class="invoice-line-items-container">
                <table class="invoice-line-items">
                  <thead>
                    <tr>
                      <th>Beschreibung</th>
                      <th style="text-align: right;">Menge</th>
                      <th style="text-align: right;">Einzelpreis</th>
                      <th style="text-align: right;">Gesamt</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${invoice.lineItems.map(item => `
                      <tr>
                        <td>${escapeHtml(item.description || '-')}</td>
                        <td style="text-align: right;">${escapeHtml(String(item.quantity || '-'))}</td>
                        <td style="text-align: right;">${escapeHtml(item.unitPrice || '-')}</td>
                        <td style="text-align: right; font-weight: 600;">${escapeHtml(item.total || '-')}</td>
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>
            </div>
            ` : ''}
            
            ${invoice.status === 'error' && invoice.errorMessage ? `
            <div class="invoice-detail-card" style="margin-top: 1.5rem; border-color: rgba(239, 68, 68, 0.5); background: rgba(239, 68, 68, 0.1);">
              <h3 style="color: #f87171;">Fehler</h3>
              <p style="color: #f87171;">${escapeHtml(invoice.errorMessage)}</p>
            </div>
            ` : ''}
          </div>
          
          <!-- Right Column: PDF Preview -->
          <div>
            <!-- Invoice Preview -->
            <div class="invoice-detail-card invoice-preview-card" style="height: 100%; display: flex; flex-direction: column; padding: 0;">
              <div class="invoice-preview-header">
                <h3 style="margin: 0; padding: 1.5rem 1.5rem 1rem 1.5rem;">Rechnungsvorschau</h3>
              </div>
              <div class="invoice-preview-wrapper" style="flex: 1; display: flex; flex-direction: column; min-height: 0; padding: 0 1.5rem 1.5rem 1.5rem;">
                ${invoice.fileType && invoice.fileType.startsWith('image/') 
                  ? `<div class="image-preview-container"><img src="${escapeHtml(invoice.fileData)}" alt="${escapeHtml(invoice.fileName)}" class="invoice-preview"></div>`
                  : invoice.fileType === 'application/pdf'
                  ? `
                    <div class="pdf-preview-container">
                      <!-- PDF Viewer - clean, no toolbar, scrollable for multiple pages -->
                      <object data="${escapeHtml(invoice.fileData)}#toolbar=0&navpanes=0&scrollbar=1&view=Fit" type="application/pdf" class="invoice-preview pdf-object" title="Rechnungsvorschau">
                        <iframe src="${escapeHtml(invoice.fileData)}#toolbar=0&navpanes=0&scrollbar=1&view=Fit" class="invoice-preview pdf-iframe" title="Rechnungsvorschau"></iframe>
                      </object>
                      <!-- Fallback: Direct link to PDF -->
                      <div class="pdf-fallback">
                        <a href="${escapeHtml(invoice.fileData)}" target="_blank" class="pdf-link-btn">
                          üìÑ PDF √∂ffnen
                        </a>
                      </div>
                    </div>
                  `
                  : `<div style="padding: 3rem; text-align: center; color: #94a3b8;">Vorschau nicht verf√ºgbar</div>`
                }
              </div>
            </div>
          </div>
        </div>
      `;
      
      body.innerHTML = html;
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
      
      // Scroll to top of modal
      modal.scrollTop = 0;
    }
    
    // Close invoice detail view (global function)
    window.closeInvoiceDetail = function() {
      const modal = document.getElementById('invoice-detail-modal');
      if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    };
    
    // Close modal on background click
    document.addEventListener('click', (e) => {
      const modal = document.getElementById('invoice-detail-modal');
      if (modal && e.target === modal) {
        window.closeInvoiceDetail();
      }
    });
    
    // Close modal on ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        window.closeInvoiceDetail();
      }
    });
    
    // Event Listeners
    document.addEventListener('DOMContentLoaded', () => {
      // Demo invoice cards - WICHTIG: Verhindere dass iframe-Clicks den Link triggern
      document.querySelectorAll('.demo-card-link[data-invoice-sample]').forEach(link => {
        link.addEventListener('click', async (e) => {
          // Verhindere Klick wenn auf iframe geklickt wurde
          if (e.target.tagName === 'IFRAME' || e.target.closest('iframe')) {
            e.stopPropagation();
            return;
          }
          
          e.preventDefault();
          const sampleId = parseInt(link.getAttribute('data-invoice-sample'));
          console.log('üìã Loading sample invoice:', sampleId);
          await loadSampleInvoice(sampleId);
        });
      });
      
      // Upload label - verhindere dass Label-Click den Card-Link triggert
      const uploadLabel = document.querySelector('label[for="invoice-upload-input"]');
      if (uploadLabel) {
        uploadLabel.addEventListener('click', (e) => {
          e.stopPropagation();
          // File input wird automatisch ge√∂ffnet durch label[for]
        }, { capture: true });
      }
      
      // Upload input
      const uploadInput = document.getElementById('invoice-upload-input');
      if (uploadInput) {
        uploadInput.addEventListener('change', async (e) => {
          const file = e.target.files?.[0];
          if (!file) {
            console.log('‚ö†Ô∏è Keine Datei ausgew√§hlt');
            return;
          }
          
          console.log('üì§ File selected:', file.name, file.type, file.size);
          
          // Validate file type
          const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'application/pdf'];
          if (!allowedTypes.includes(file.type)) {
            alert('‚ö†Ô∏è Bitte laden Sie nur JPG, PNG oder PDF Dateien hoch!');
            uploadInput.value = '';
            return;
          }
          
          // Validate file size (10MB)
          if (file.size > 10 * 1024 * 1024) {
            alert('‚ö†Ô∏è Die Datei ist zu gro√ü (max. 10 MB)!');
            uploadInput.value = '';
            return;
          }
          
          try {
            await uploadInvoice(file);
          } catch (error) {
            console.error('‚ùå Upload error:', error);
          } finally {
            uploadInput.value = '';
          }
        });
      }
      
      // Clear button
      const clearBtn = document.getElementById('btn-clear-results');
      if (clearBtn) {
        clearBtn.addEventListener('click', (e) => {
          e.preventDefault();
          clearAllResults();
        });
      }
      
      // Download buttons
      const csvBtn = document.getElementById('btn-download-csv');
      if (csvBtn) {
        csvBtn.addEventListener('click', (e) => {
          e.preventDefault();
          downloadCSV();
        });
      }
      
      const jsonBtn = document.getElementById('btn-download-json');
      if (jsonBtn) {
        jsonBtn.addEventListener('click', (e) => {
          e.preventDefault();
          downloadJSON();
        });
      }
      
      // Load existing invoices on page load
      console.log('üìã Loading existing invoices...');
      loadExistingInvoices();
      
      console.log('‚úÖ Invoice extraction page initialized');
    });
    
    // Load existing invoices from API
    async function loadExistingInvoices() {
      try {
        console.log('üìã Fetching existing invoices from:', `${API_BASE_URL}/api/invoices`);
        const response = await fetch(`${API_BASE_URL}/api/invoices`, {
          method: 'GET',
          credentials: 'include',
          headers: {
            'Accept': 'application/json'
          }
        });
        
        if (!response.ok) {
          const errorText = await response.text();
          console.error('‚ùå Failed to fetch invoices:', response.status, response.statusText, errorText);
          // Don't show error to user - just log it
          return;
        }
        
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
          console.warn('‚ö†Ô∏è Unexpected content type:', contentType);
        }
        
        const invoices = await response.json();
        console.log('‚úÖ Loaded invoices:', invoices.length);
        
        // Filter out demo invoices and add to extractedInvoices
        const userInvoices = invoices.filter(inv => !inv.id || !inv.id.startsWith('demo-'));
        console.log('üìä User invoices (excluding demos):', userInvoices.length);
        
        extractedInvoices.length = 0;
        extractedInvoices.push(...userInvoices.map(inv => {
          // Store full invoice details
          invoiceDetails.set(inv.id, inv);
          return {
            id: inv.id,
            invoiceNumber: inv.invoiceNumber || '',
            invoiceDate: inv.invoiceDate || '',
            supplierName: inv.supplierName || '',
            supplierVatId: inv.supplierVatId || '',
            totalAmount: inv.totalAmount || '',
            status: inv.status || 'processing',
            createdAt: inv.createdAt || inv.created_at || new Date().toISOString(),
            source: 'Upload'
          };
        }));
        
        renderResults();
        
        // Poll for any processing invoices
        userInvoices.forEach(inv => {
          if (inv.status === 'processing') {
            console.log('‚è≥ Polling status for processing invoice:', inv.id);
            pollInvoiceStatus(inv.id);
          }
        });
      } catch (error) {
        console.error('‚ùå Error loading existing invoices:', error);
        // Don't show error to user on page load - just log it
      }
    }
  </script>
</body>
</html>
