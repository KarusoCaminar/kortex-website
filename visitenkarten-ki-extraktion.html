<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visitenkarten digitalisieren KI ‚Äì Automatische Datenextraktion mit n8n | Kortex System</title>
  <meta name="description" content="Visitenkarten automatisch digitalisieren mit KI. n8n Workflow extrahiert Kontaktdaten DSGVO-konform in 20 Sekunden. 95% Genauigkeit. Kostenlose Demo jetzt testen!">
  <meta name="keywords" content="Visitenkarten digitalisieren KI, Visitenkarten-Scanner B2B, Datenextraktion n8n, Kontakterfassung automatisieren, DSGVO Visitenkarten, Visitenkarten OCR">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://www.kortex-system.com/visitenkarten-ki-extraktion.html">
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Visitenkarten digitalisieren KI ‚Äì Automatische Datenextraktion mit n8n">
  <meta property="og:description" content="Visitenkarten automatisch digitalisieren mit KI. n8n Workflow extrahiert Kontaktdaten DSGVO-konform in 20 Sekunden.">
  <meta property="og:url" content="https://www.kortex-system.com/visitenkarten-ki-extraktion.html">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Kortex System">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Visitenkarten digitalisieren KI ‚Äì Automatische Datenextraktion">
  <meta name="twitter:description" content="Visitenkarten automatisch digitalisieren mit KI. n8n Workflow extrahiert Kontaktdaten DSGVO-konform.">
  
  <!-- Schema Markup: HowTo -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "Visitenkarten mit KI digitalisieren",
    "description": "Automatische Kontakterfassung aus Visitenkarten mit n8n Workflow und KI",
    "step": [
      {
        "@type": "HowToStep",
        "name": "Visitenkarte ausw√§hlen",
        "text": "Klicken Sie auf eine Demo-Visitenkarte oder laden Sie Ihre eigene Visitenkarte hoch",
        "position": 1
      },
      {
        "@type": "HowToStep",
        "name": "KI-Extraktion starten",
        "text": "Die KI analysiert automatisch die Visitenkarte und extrahiert alle Kontaktdaten",
        "position": 2
      },
      {
        "@type": "HowToStep",
        "name": "Ergebnisse pr√ºfen",
        "text": "Extrahierte Kontaktdaten erscheinen automatisch in der Tabelle",
        "position": 3
      },
      {
        "@type": "HowToStep",
        "name": "Daten exportieren",
        "text": "Exportieren Sie die Kontaktdaten als CSV oder JSON f√ºr die Integration in Ihr CRM-System",
        "position": 4
      }
    ]
  }
  </script>

  <!-- Schema Markup: FAQPage -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "Welche KI-Modelle werden f√ºr die Visitenkarten-Texterkennung genutzt?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Wir nutzen Google Gemini 2.5 Flash √ºber die Vertex AI API. Dieses moderne KI-Modell kombiniert hohe Erkennungsgenauigkeit (95%) mit schneller Verarbeitung."
        }
      },
      {
        "@type": "Question",
        "name": "Wie wird der n8n-Workflow in unsere bestehende IT (z.B. CRM) integriert?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Der n8n Workflow kann √ºber Webhook-Integration, CSV/JSON-Export oder REST-API-Anbindung in CRM-Systeme wie Salesforce, HubSpot oder Microsoft Dynamics integriert werden."
        }
      },
      {
        "@type": "Question",
        "name": "Ist die Erkennungsgenauigkeit von 95% garantiert?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Die 95% Erkennungsgenauigkeit basiert auf durchschnittlichen Werten bei guter Bildqualit√§t. Bei optimalen Bedingungen erreichen wir bis zu 98% Genauigkeit. Alle extrahierten Daten werden automatisch validiert."
        }
      },
      {
        "@type": "Question",
        "name": "Welche Datenformate (CSV, JSON) werden unterst√ºtzt?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Wir unterst√ºtzen CSV-Export (kompatibel mit Excel, Google Sheets, alle CRM-Systeme) und JSON-Export f√ºr programmatische Integration."
        }
      },
      {
        "@type": "Question",
        "name": "Wie lange dauert die Verarbeitung einer Visitenkarte?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Die Verarbeitung einer einzelnen Visitenkarte dauert durchschnittlich 20 Sekunden ‚Äì von Upload bis zu vollst√§ndig extrahierten Kontaktdaten. Im Vergleich zur manuellen Erfassung sparen Sie 93% der Zeit."
        }
      }
    ]
  }
  </script>

  <!-- Schema Markup: BreadcrumbList -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Startseite",
        "item": "https://www.kortex-system.com/"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Visitenkarten-Extraktion",
        "item": "https://www.kortex-system.com/visitenkarten-ki-extraktion.html"
      }
    ]
  }
  </script>

  <script src="translations.js"></script>
  <script src="i18n.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #0a1628 0%, #09182F 100%);
      min-height: 100vh;
      color: white;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 60px 20px;
    }
    
    header {
      text-align: center;
      margin-bottom: 4rem;
    }
    
    h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .subtitle {
      font-size: 1.3rem;
      color: #94a3b8;
      margin-bottom: 1rem;
    }
    
    /* Demo Cards Grid */
    .demo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 3rem;
      margin-top: 3rem;
    }
    
    .demo-card-link {
      text-decoration: none;
      display: block;
      transition: transform 0.3s ease;
    }
    
    .demo-card-link:hover {
      transform: translateY(-8px);
    }
    
    .demo-card {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 16px;
      padding: 2.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .demo-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .demo-card:hover::before {
      opacity: 1;
    }
    
    .demo-card:hover {
      border-color: rgba(96, 165, 250, 0.5);
      box-shadow: 0 20px 60px rgba(59, 130, 246, 0.3);
    }
    
    .demo-icon {
      font-size: 4rem;
      margin-bottom: 1.5rem;
      display: block;
    }
    
    .demo-card h3 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
      color: white;
      position: relative;
      z-index: 1;
    }
    
    .demo-card p {
      font-size: 1rem;
      color: #94a3b8;
      line-height: 1.6;
      margin-bottom: 1.5rem;
      position: relative;
      z-index: 1;
      flex-grow: 1;
    }
    
    .demo-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      position: relative;
      z-index: 1;
    }
    
    .tag {
      background: rgba(59, 130, 246, 0.2);
      color: #60a5fa;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .tag.success {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
    }
    
    .arrow-icon {
      position: absolute;
      bottom: 2rem;
      right: 2rem;
      font-size: 2rem;
      font-weight: bold;
      color: #60a5fa;
      transition: transform 0.3s ease;
    }
    
    .demo-card:hover .arrow-icon {
      transform: translateX(8px);
    }
    
    /* ===== MODAL STYLES ===== */
    #workflow-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 10000;
      backdrop-filter: blur(8px);
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    #workflow-modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #workflow-iframe-container {
      position: relative;
      width: 95%;
      height: 95%;
      max-width: 1600px;
      max-height: 950px;
      /* Verhindere wei√ües Bild - dunkler Hintergrund */
      background: linear-gradient(135deg, #0a1628 0%, #09182F 100%);
      border-radius: 16px;
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.6), 0 0 0 2px rgba(96, 165, 250, 0.2);
      overflow: hidden;
      animation: slideUp 0.4s ease;
    }
    
    @keyframes slideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    #workflow-close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #ef4444;
      color: white;
      border: none;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 28px;
      line-height: 1;
      z-index: 10001;
      transition: all 0.2s;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #workflow-close-btn:hover {
      background: #dc2626;
      transform: rotate(90deg) scale(1.1);
    }
    
    #workflow-iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 16px;
    }
    
    .loading-indicator {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      z-index: 10000;
      width: 90%;
      max-width: 500px;
      /* Verhindere wei√ües Bild beim Laden */
      background: transparent;
    }
    
    .loading-content {
      background: rgba(15, 23, 42, 0.98);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 2.5rem;
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(148, 163, 184, 0.2);
      border: 2px solid rgba(96, 165, 250, 0.3);
      /* Smooth Animation */
      animation: loadingFadeIn 0.3s ease;
    }
    
    @keyframes loadingFadeIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-top: 4px solid #60a5fa;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin: 0 auto 1.5rem;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      color: #60a5fa;
      font-size: 1.1rem;
      font-weight: 500;
      margin-bottom: 1rem;
    }
    
    /* Error State Styles */
    .error-state {
      background: rgba(239, 68, 68, 0.1);
      border: 2px solid rgba(239, 68, 68, 0.3);
    }
    
    .error-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(239, 68, 68, 0.15);
      border-radius: 50%;
      animation: errorPulse 2s ease infinite;
    }
    
    @keyframes errorPulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.9; }
    }
    
    .error-icon svg {
      width: 40px;
      height: 40px;
      stroke: #ef4444;
    }
    
    .error-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #ef4444;
      margin: 0 0 0.75rem;
      letter-spacing: -0.02em;
    }
    
    .error-message {
      font-size: 1rem;
      color: #f1f5f9;
      line-height: 1.6;
      margin: 0 0 1rem;
      font-weight: 400;
    }
    
    .error-details {
      font-size: 0.875rem;
      color: #94a3b8;
      line-height: 1.5;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(148, 163, 184, 0.2);
    }
    
    .progress-bar-container {
      width: 100%;
      height: 8px;
      background: rgba(148, 163, 184, 0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 1rem;
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #60a5fa 0%, #a78bfa 100%);
      border-radius: 4px;
      width: 0%;
      transition: width 0.3s ease;
      animation: progressPulse 2s ease-in-out infinite;
    }
    
    @keyframes progressPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .loading-stage {
      color: #94a3b8;
      font-size: 0.9rem;
      margin-top: 0.5rem;
      min-height: 1.2rem;
    }
    
    .success-indicator {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      z-index: 10000;
      width: 90%;
      max-width: 500px;
      animation: successSlideIn 0.4s ease;
    }
    
    .success-content {
      background: rgba(34, 197, 94, 0.15);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 8px 32px rgba(34, 197, 94, 0.3);
      border: 2px solid rgba(34, 197, 94, 0.5);
    }
    
    .success-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 1rem;
      border-radius: 50%;
      background: #22c55e;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      animation: successScale 0.5s ease;
    }
    
    @keyframes successScale {
      0% { transform: scale(0); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    @keyframes successSlideIn {
      from {
        transform: translateX(-50%) scale(0.8);
        opacity: 0;
      }
      to {
        transform: translateX(-50%) scale(1);
        opacity: 1;
      }
    }
    
    .success-text {
      color: #22c55e;
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    .success-message {
      color: #94a3b8;
      font-size: 0.95rem;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
      }
      
      .subtitle {
        font-size: 1rem;
      }
      
      .demo-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
      
      .demo-card {
        padding: 2rem;
      }
      
      #workflow-iframe-container {
        width: 100%;
        height: 100%;
        border-radius: 0;
      }
      
      #workflow-close-btn {
        top: 10px;
        right: 10px;
        width: 40px;
        height: 40px;
        font-size: 24px;
      }
      
      /* Mobile: Results Table -> Card Layout */
      #results-table {
        display: block;
        width: 100%;
      }
      
      #results-table thead {
        display: none;
      }
      
      #results-table tbody {
        display: block;
      }
      
      #results-table tbody tr {
        display: block;
        margin-bottom: 1rem;
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 12px;
        padding: 1rem;
        padding-bottom: 0.5rem;
      }
      
      #results-table tbody td {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        padding: 0.75rem 0;
        border: none;
        border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        font-size: 14px;
      }
      
      #results-table tbody td:last-child {
        border-bottom: none;
      }
      
      #results-table tbody td::before {
        content: attr(data-label);
        font-weight: 600;
        color: #60a5fa;
        margin-right: 1rem;
        min-width: 100px;
        font-size: 14px;
      }
      
      /* Results header buttons on mobile */
      @media (max-width: 768px) {
        /* Results header - buttons stacked */
        .results-header-buttons {
          display: flex !important;
          flex-direction: column !important;
          gap: 0.75rem !important;
          width: 100% !important;
        }
        
        .results-header-buttons button {
          width: 100% !important;
          font-size: 14px !important;
          padding: 12px 16px !important;
        }
        
        /* Results header container */
        .results-header-container {
          flex-direction: column !important;
          align-items: flex-start !important;
          gap: 1rem !important;
          padding: 1rem !important;
        }
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Visitenkarten-Extraktion: KI-basierte Kontakterfassung f√ºr Ihr Business</h1>
      <p class="subtitle" data-i18n="modal.subtitle">Intelligente Automatisierung f√ºr Ihr Business</p>
    </header>

    <!-- SEO Content Section: Problem & L√∂sung (150 W√∂rter) -->
    <section style="margin-bottom: 3rem; max-width: 900px; margin-left: auto; margin-right: auto;">
      <h2 style="font-size: 2rem; margin-bottom: 1.5rem; color: #60a5fa;">Das Problem: Zeitverschwendung bei manueller Kontakterfassung</h2>
      <p style="font-size: 1.1rem; line-height: 1.8; color: #cbd5e1; margin-bottom: 1.5rem;">
        Jeden Tag stapeln sich Visitenkarten auf dem Schreibtisch ‚Äì vom Messebesuch, Netzwerk-Event oder Gesch√§ftstreffen. Die manuelle Erfassung in CRM-Systeme kostet wertvolle Arbeitszeit: Pro Visitenkarte ben√∂tigen Sie durchschnittlich 5 Minuten f√ºr Dateneingabe, Validierung und Formatierung. Bei 50 Visitenkarten pro Monat bedeutet das <strong>√ºber 4 Stunden reine Verwaltungszeit</strong> ‚Äì Zeit, die f√ºr Ihr Kerngesch√§ft verloren geht.
      </p>
      <p style="font-size: 1.1rem; line-height: 1.8; color: #cbd5e1; margin-bottom: 1.5rem;">
        Unsere KI-basierte L√∂sung automatisiert diesen Prozess vollst√§ndig: Mit <strong>Gemini 2.5 Flash</strong> und einem flexiblen <strong>n8n Workflow</strong> extrahieren wir alle Kontaktdaten automatisch ‚Äì Name, Firma, E-Mail, Telefon, Adresse und Website. Das Ergebnis: Aus 5 Minuten pro Visitenkarte werden <strong>20 Sekunden</strong>. Ihre Mitarbeiter gewinnen monatlich bis zu 40 Arbeitsstunden zur√ºck.
      </p>
    </section>

    <!-- SEO Content Section: Messbare Ergebnisse & ROI (200 W√∂rter) -->
    <section style="margin-bottom: 3rem; max-width: 900px; margin-left: auto; margin-right: auto; background: rgba(15, 23, 42, 0.6); padding: 2.5rem; border-radius: 16px; border: 1px solid rgba(148, 163, 184, 0.2);">
      <h2 style="font-size: 2rem; margin-bottom: 1.5rem; color: #60a5fa;">Messbare Ergebnisse & ROI</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 1.5rem;">
        <div>
          <h3 style="font-size: 1.5rem; margin-bottom: 0.75rem; color: #4ade80;">Zeitersparnis</h3>
          <p style="font-size: 1.1rem; line-height: 1.8; color: #cbd5e1;">
            <strong>Bis zu 40 Arbeitsstunden pro Monat</strong> bei durchschnittlich 50 Visitenkarten. Aus 5 Minuten pro Karte werden 20 Sekunden ‚Äì eine <strong>Zeitersparnis von 93%</strong>.
          </p>
        </div>
        <div>
          <h3 style="font-size: 1.5rem; margin-bottom: 0.75rem; color: #4ade80;">Erkennungsgenauigkeit</h3>
          <p style="font-size: 1.1rem; line-height: 1.8; color: #cbd5e1;">
            <strong>95% Erkennungsgenauigkeit</strong> dank modernster KI-Modelle. Automatische Validierung von E-Mail-Adressen und Telefonnummern reduziert Fehlerquoten auf ein Minimum.
          </p>
        </div>
        <div>
          <h3 style="font-size: 1.5rem; margin-bottom: 0.75rem; color: #4ade80;">Kostenreduktion</h3>
          <p style="font-size: 1.1rem; line-height: 1.8; color: #cbd5e1;">
            Bei einem Stundensatz von 50‚Ç¨ sparen Sie <strong>monatlich bis zu 2.000‚Ç¨ Verwaltungskosten</strong>. Die Amortisation erfolgt bereits im ersten Monat.
          </p>
        </div>
      </div>
      <p style="font-size: 1.1rem; line-height: 1.8; color: #cbd5e1;">
        Die Datenqualit√§t wird durch mehrstufige Validierungsprozesse garantiert. Alle extrahierten Kontaktdaten werden automatisch auf Vollst√§ndigkeit und Korrektheit gepr√ºft ‚Äì von E-Mail-Format bis Telefonnummer-Struktur. Exportm√∂glichkeiten in <strong>CSV und JSON</strong> erm√∂glichen nahtlose Integration in bestehende CRM-Systeme wie Salesforce, HubSpot oder Microsoft Dynamics.
      </p>
    </section>

    <!-- SEO Content Section: DSGVO-Konformit√§t (150 W√∂rter) -->
    <section style="margin-bottom: 3rem; max-width: 900px; margin-left: auto; margin-right: auto;">
      <h2 style="font-size: 2rem; margin-bottom: 1.5rem; color: #60a5fa;">DSGVO-Konformit√§t: Datenverarbeitung nach europ√§ischen Standards</h2>
      <p style="font-size: 1.1rem; line-height: 1.8; color: #cbd5e1; margin-bottom: 1.5rem;">
        Alle Server befinden sich in Deutschland oder der EU, sodass die Datenverarbeitung vollst√§ndig den Anforderungen der <strong>DSGVO (Datenschutz-Grundverordnung)</strong> entspricht. Nach erfolgreicher Extraktion werden die hochgeladenen Bilder automatisch gel√∂scht ‚Äì keine dauerhafte Speicherung von personenbezogenen Daten. Die extrahierten Kontaktdaten werden ausschlie√ülich in Ihrer Kontrolle gespeichert und k√∂nnen jederzeit gel√∂scht werden.
      </p>
      <p style="font-size: 1.1rem; line-height: 1.8; color: #cbd5e1; margin-bottom: 1.5rem;">
        Der n8n Workflow kann optional als <strong>Self-Hosted-L√∂sung</strong> in Ihrer eigenen Infrastruktur betrieben werden, falls zus√§tzliche Sicherheitsanforderungen bestehen. Dies bietet maximale Kontrolle √ºber den gesamten Datenverarbeitungsprozess und erm√∂glicht die Integration in unternehmensinterne Compliance-Richtlinien.
      </p>
    </section>

    <!-- SEO Content Section: Technologie (100 W√∂rter) -->
    <section style="margin-bottom: 3rem; max-width: 900px; margin-left: auto; margin-right: auto;">
      <h2 style="font-size: 2rem; margin-bottom: 1.5rem; color: #60a5fa;">Technologie: Warum n8n & Gemini 2.5 Flash?</h2>
      <p style="font-size: 1.1rem; line-height: 1.8; color: #cbd5e1; margin-bottom: 1.5rem;">
        <strong>n8n</strong> ist die ideale Basis f√ºr diesen Workflow: Die Open-Source-Automatisierungsplattform bietet maximale Flexibilit√§t f√ºr individuelle Anpassungen und kann als Self-Hosted-L√∂sung in Ihrer eigenen IT-Infrastruktur betrieben werden. F√ºr die Texterkennung nutzen wir <strong>Google Gemini 2.5 Flash</strong> ‚Äì ein modernes KI-Modell, das hohe Erkennungsgenauigkeit mit schneller Verarbeitung kombiniert. Die Kombination erm√∂glicht eine zuverl√§ssige, skalierbare und kosteneffiziente Automatisierungsl√∂sung.
      </p>
    </section>

    <!-- Demo Section -->
    <h2 style="font-size: 2rem; margin-bottom: 2rem; text-align: center; color: #60a5fa; margin-top: 3rem;">Live-Demo: Visitenkarten-Extraktion jetzt testen</h2>

    <!-- Demo Cards Grid -->
    <div class="demo-grid">
      
      <!-- Card 1: Business Card Extraction (n8n) ‚Äì Sample 1 -->
      <a href="#" class="demo-card-link" 
         data-workflow-url="https://n8n2.kortex-system.de/webhook/business-card-extraction" 
         data-params="sample=1"
         data-title="Visitenkarten Demo ‚Äì Sample 1"
         data-sample-image="https://karusocaminar.github.io/kortex-website/samples/bc-1.jpg">
        <div class="demo-card">
          <div style="text-align: center; margin-bottom: 1.5rem;">
            <img src="https://karusocaminar.github.io/kortex-website/samples/bc-1.jpg" 
                 alt="Beispiel einer Visitenkarte die per KI digitalisiert wird - Automatische Kontakterfassung mit n8n Workflow" 
                 style="width: 100%; max-width: 600px; height: auto; object-fit: contain; border-radius: 12px; border: 2px solid rgba(148, 163, 184, 0.3); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2); background: rgba(255, 255, 255, 0.05);"
                 onerror="this.style.display='none'">
          </div>
          <h3 style="margin-bottom: 0.5rem;" data-i18n="modal.card1.title">Business Card ‚Äì Sample 1</h3>
          <p style="font-size: 0.95rem; color: #94a3b8; margin: 0 0 1rem 0;" data-i18n="modal.card1.person">Oliver Krause - Datenschutzbeauftragter</p>
          <p style="font-size: 0.9rem;" data-i18n="modal.card1.description">Klicke auf diese Demo-Visitenkarte ‚Üí KI extrahiert automatisch Name, Firma, E-Mail, Telefon ‚Üí Ergebnis erscheint in der Tabelle.</p>
          
          <div class="demo-tags">
            <span class="tag" data-i18n="modal.tag.speed">‚ö° 5 Sek/Karte</span>
            <span class="tag success" data-i18n="modal.tag.accuracy">‚úÖ 95% Genauigkeit</span>
            <span class="tag" data-i18n="modal.tag.n8n">üîó n8n-Powered</span>
          </div>
          
          <span class="arrow-icon">‚Üí</span>
        </div>
      </a>
      
      <!-- Card 2: Business Card Extraction (n8n) ‚Äì Sample 2 -->
      <a href="#" class="demo-card-link" 
         data-workflow-url="https://n8n2.kortex-system.de/webhook/business-card-extraction" 
         data-params="sample=2"
         data-title="Visitenkarten Demo ‚Äì Sample 2"
         data-sample-image="https://karusocaminar.github.io/kortex-website/samples/bc-2.jpg">
        <div class="demo-card">
          <div style="text-align: center; margin-bottom: 1.5rem;">
            <img src="https://karusocaminar.github.io/kortex-website/samples/bc-2.jpg" 
                 alt="Beispiel einer Visitenkarte die per KI digitalisiert wird - Automatische Kontakterfassung mit n8n Workflow" 
                 style="width: 100%; max-width: 600px; height: auto; object-fit: contain; border-radius: 12px; border: 2px solid rgba(148, 163, 184, 0.3); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2); background: rgba(255, 255, 255, 0.05);"
                 onerror="this.style.display='none'">
          </div>
          <h3 style="margin-bottom: 0.5rem;" data-i18n="modal.card2.title">Business Card ‚Äì Sample 2</h3>
          <p style="font-size: 0.95rem; color: #94a3b8; margin: 0 0 1rem 0;" data-i18n="modal.card2.person">Gabi Gra√ünick - Bestattungen Gra√ünick</p>
          <p style="font-size: 0.9rem;" data-i18n="modal.card2.description">Klicke auf diese Demo-Visitenkarte ‚Üí KI extrahiert automatisch Name, Firma, E-Mail, Telefon ‚Üí Ergebnis erscheint in der Tabelle.</p>
          
          <div class="demo-tags">
            <span class="tag" data-i18n="modal.tag.speed">‚ö° 5 Sek/Karte</span>
            <span class="tag success" data-i18n="modal.tag.accuracy">‚úÖ 95% Genauigkeit</span>
            <span class="tag" data-i18n="modal.tag.n8n">üîó n8n-Powered</span>
          </div>
          
          <span class="arrow-icon">‚Üí</span>
        </div>
      </a>
      
      <!-- Card 3: Business Card Extraction (n8n) ‚Äì Sample 3 -->
      <a href="#" class="demo-card-link" 
         data-workflow-url="https://n8n2.kortex-system.de/webhook/business-card-extraction" 
         data-params="sample=3"
         data-title="Visitenkarten Demo ‚Äì Sample 3"
         data-sample-image="https://karusocaminar.github.io/kortex-website/samples/bc-3.jpg">
        <div class="demo-card">
          <div style="text-align: center; margin-bottom: 1.5rem;">
            <img src="https://karusocaminar.github.io/kortex-website/samples/bc-3.jpg" 
                 alt="Beispiel einer Visitenkarte die per KI digitalisiert wird - Automatische Kontakterfassung mit n8n Workflow" 
                 style="width: 100%; max-width: 600px; height: auto; object-fit: contain; border-radius: 12px; border: 2px solid rgba(148, 163, 184, 0.3); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2); background: rgba(255, 255, 255, 0.05);"
                 onerror="this.style.display='none'">
          </div>
          <h3 style="margin-bottom: 0.5rem;" data-i18n="modal.card3.title">Business Card ‚Äì Sample 3</h3>
          <p style="font-size: 0.95rem; color: #94a3b8; margin: 0 0 1rem 0;" data-i18n="modal.card3.person">Klicke auf diese Demo-Visitenkarte ‚Üí KI extrahiert automatisch alle Kontaktdaten</p>
          <p style="font-size: 0.9rem;" data-i18n="modal.card3.description">Klicke auf diese Demo-Visitenkarte ‚Üí KI extrahiert automatisch Name, Firma, E-Mail, Telefon ‚Üí Ergebnis erscheint in der Tabelle.</p>
          
          <div class="demo-tags">
            <span class="tag" data-i18n="modal.tag.speed">‚ö° 5 Sek/Karte</span>
            <span class="tag success" data-i18n="modal.tag.accuracy">‚úÖ 95% Genauigkeit</span>
            <span class="tag" data-i18n="modal.tag.n8n">üîó n8n-Powered</span>
          </div>
          
          <span class="arrow-icon">‚Üí</span>
        </div>
      </a>
      
      <!-- Card 4: Eigene Visitenkarte hochladen (n8n Form) -->
      <label for="business-card-upload-input" class="demo-card-link" style="cursor: pointer;">
        <div class="demo-card">
          <span class="demo-icon">ü™™</span>
          <h3 data-i18n="modal.card4.title">Eigene Visitenkarte hochladen</h3>
          <p data-i18n="modal.card4.description">Klicke hier ‚Üí W√§hle deine Visitenkarte ‚Üí KI extrahiert ‚Üí Ergebnis erscheint in der Tabelle unten.</p>
          
          <div class="demo-tags">
            <span class="tag" data-i18n="modal.tag.gdpr">üîí DSGVO</span>
            <span class="tag success" data-i18n="modal.tag.upload">üì• Upload</span>
            <span class="tag" data-i18n="modal.tag.ai">üß† KI</span>
          </div>
          
          <span class="arrow-icon">‚Üí</span>
        </div>
      </label>
      <input type="file" id="business-card-upload-input" accept="image/jpeg,image/png,image/jpg" style="display: none;">
      
    </div>

    <!-- Results Section -->
    <div style="margin-top: 3rem; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 16px;">
      <div class="results-header-container" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.25rem; border-bottom: 1px solid rgba(148, 163, 184, 0.2);">
        <div style="font-weight: 600;" data-i18n="modal.results.title">Extrahierte Kontaktdaten <span id="results-count" style="font-weight: normal; color: #94a3b8; font-size: 0.9em; margin-left: 0.5rem;">(0)</span></div>
        <div class="results-header-buttons" style="display: flex; gap: 0.5rem;">
          <button id="btn-clear-results" style="background:#ef4444;color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-size:0.9rem;" data-i18n="modal.results.clear" data-i18n-aria-label="modal.results.clear">üóëÔ∏è L√∂schen</button>
          <button id="btn-download-csv" style="background:#1e40af;color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;" data-i18n="modal.results.downloadCsv">CSV herunterladen</button>
          <button id="btn-download-json" style="background:#0f766e;color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;" data-i18n="modal.results.downloadJson">JSON herunterladen</button>
        </div>
      </div>
      <div style="overflow-x: auto;">
        <table id="results-table" style="width:100%; border-collapse: collapse;">
          <thead>
            <tr style="background: rgba(148, 163, 184, 0.15); text-align: left;">
              <th style="padding: 12px 16px; border-bottom: 1px solid rgba(148,163,184,0.2);" data-i18n="modal.table.name">Name</th>
              <th style="padding: 12px 16px; border-bottom: 1px solid rgba(148,163,184,0.2);" data-i18n="modal.table.company">Firma</th>
              <th style="padding: 12px 16px; border-bottom: 1px solid rgba(148,163,184,0.2);" data-i18n="modal.table.email">E-Mail</th>
              <th style="padding: 12px 16px; border-bottom: 1px solid rgba(148,163,184,0.2);" data-i18n="modal.table.phone">Telefon</th>
              <th style="padding: 12px 16px; border-bottom: 1px solid rgba(148,163,184,0.2);" data-i18n="modal.table.address">Adresse</th>
              <th style="padding: 12px 16px; border-bottom: 1px solid rgba(148,163,184,0.2);" data-i18n="modal.table.website">Website</th>
              <th style="padding: 12px 16px; border-bottom: 1px solid rgba(148,163,184,0.2);" data-i18n="modal.table.source">Quelle</th>
              <th style="padding: 12px 16px; border-bottom: 1px solid rgba(148,163,184,0.2);" data-i18n="modal.table.time">Zeit</th>
            </tr>
          </thead>
          <tbody id="results-tbody">
            <tr>
              <td colspan="8" style="padding:16px; color:#94a3b8;" data-i18n="modal.results.empty">Noch keine Ergebnisse. Starte eine Demo oben.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- FAQ Section -->
    <section id="faq-section" style="margin-top: 4rem; max-width: 900px; margin-left: auto; margin-right: auto; margin-bottom: 3rem;">
      <h2 style="font-size: 2rem; margin-bottom: 2rem; text-align: center; color: #60a5fa;">H√§ufige Fragen (FAQ)</h2>
      
      <div style="display: flex; flex-direction: column; gap: 1.5rem;">
        <details style="background: rgba(15, 23, 42, 0.6); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(148, 163, 184, 0.2); cursor: pointer;">
          <summary style="font-size: 1.3rem; font-weight: 600; color: #60a5fa; margin-bottom: 1rem; cursor: pointer;">Welche KI-Modelle werden f√ºr die Visitenkarten-Texterkennung genutzt?</summary>
          <p style="font-size: 1.1rem; line-height: 1.8; color: #cbd5e1; margin-top: 1rem;">
            Wir nutzen <strong>Google Gemini 2.5 Flash</strong> √ºber die Vertex AI API. Dieses moderne KI-Modell kombiniert hohe Erkennungsgenauigkeit (95%) mit schneller Verarbeitung. Die Texterkennung erfolgt vollst√§ndig automatisch ‚Äì von gedruckten Texten bis hin zu handschriftlichen Notizen auf Visitenkarten.
          </p>
        </details>

        <details style="background: rgba(15, 23, 42, 0.6); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(148, 163, 184, 0.2); cursor: pointer;">
          <summary style="font-size: 1.3rem; font-weight: 600; color: #60a5fa; margin-bottom: 1rem; cursor: pointer;">Wie wird der n8n-Workflow in unsere bestehende IT (z.B. CRM) integriert?</summary>
          <p style="font-size: 1.1rem; line-height: 1.8; color: #cbd5e1; margin-top: 1rem;">
            Der n8n Workflow kann √ºber verschiedene Wege integriert werden: <strong>Webhook-Integration</strong> f√ºr direkten Datentransfer, <strong>CSV/JSON-Export</strong> f√ºr manuellen Import in CRM-Systeme wie Salesforce, HubSpot oder Microsoft Dynamics, oder <strong>REST-API-Anbindung</strong> f√ºr vollautomatische Synchronisation. Unsere L√∂sung passt sich flexibel an Ihre bestehende IT-Infrastruktur an.
          </p>
        </details>

        <details style="background: rgba(15, 23, 42, 0.6); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(148, 163, 184, 0.2); cursor: pointer;">
          <summary style="font-size: 1.3rem; font-weight: 600; color: #60a5fa; margin-bottom: 1rem; cursor: pointer;">Ist die Erkennungsgenauigkeit von 95% garantiert?</summary>
          <p style="font-size: 1.1rem; line-height: 1.8; color: #cbd5e1; margin-top: 1rem;">
            Die <strong>95% Erkennungsgenauigkeit</strong> basiert auf durchschnittlichen Werten bei guter Bildqualit√§t (mindestens 300 DPI, klar lesbare Schrift). Bei optimalen Bedingungen erreichen wir bis zu 98% Genauigkeit. Bei verschwommenen Bildern oder handschriftlichen Notizen kann die Genauigkeit geringer ausfallen. Alle extrahierten Daten werden automatisch validiert (E-Mail-Format, Telefonnummer-Struktur) um Fehlerquoten zu minimieren.
          </p>
        </details>

        <details style="background: rgba(15, 23, 42, 0.6); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(148, 163, 184, 0.2); cursor: pointer;">
          <summary style="font-size: 1.3rem; font-weight: 600; color: #60a5fa; margin-bottom: 1rem; cursor: pointer;">Welche Datenformate (CSV, JSON) werden unterst√ºtzt?</summary>
          <p style="font-size: 1.1rem; line-height: 1.8; color: #cbd5e1; margin-top: 1rem;">
            Wir unterst√ºtzen <strong>CSV-Export</strong> (kompatibel mit Excel, Google Sheets, alle CRM-Systeme) und <strong>JSON-Export</strong> f√ºr programmatische Integration. Der CSV-Export enth√§lt alle Felder (Name, Firma, E-Mail, Telefon, Adresse, Website) und kann direkt in Ihre CRM-Systeme importiert werden. JSON-Format erm√∂glicht flexible Weiterverarbeitung √ºber APIs oder automatisierte Workflows.
          </p>
        </details>

        <details style="background: rgba(15, 23, 42, 0.6); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(148, 163, 184, 0.2); cursor: pointer;">
          <summary style="font-size: 1.3rem; font-weight: 600; color: #60a5fa; margin-bottom: 1rem; cursor: pointer;">Wie lange dauert die Verarbeitung einer Visitenkarte?</summary>
          <p style="font-size: 1.1rem; line-height: 1.8; color: #cbd5e1; margin-top: 1rem;">
            Die Verarbeitung einer einzelnen Visitenkarte dauert durchschnittlich <strong>20 Sekunden</strong> ‚Äì von Upload bis zu vollst√§ndig extrahierten Kontaktdaten. Dies umfasst Bild-Upload, KI-Analyse, Datenextraktion und Validierung. Im Vergleich zur manuellen Erfassung (durchschnittlich 5 Minuten pro Visitenkarte) sparen Sie <strong>93% der Zeit</strong>. Bei Batch-Verarbeitung mehrerer Visitenkarten kann die Verarbeitung parallelisiert werden, was weitere Zeitersparnis erm√∂glicht.
          </p>
        </details>
      </div>
    </section>

    <!-- Interne Verlinkung -->
    <section style="margin-top: 3rem; margin-bottom: 3rem; text-align: center; padding: 2rem; background: rgba(15, 23, 42, 0.4); border-radius: 16px;">
      <h3 style="font-size: 1.5rem; margin-bottom: 1.5rem; color: #60a5fa;">Verwandte Services</h3>
      <div style="display: flex; gap: 1.5rem; justify-content: center; flex-wrap: wrap;">
        <a href="/" style="color: #60a5fa; text-decoration: none; font-size: 1.1rem; padding: 0.75rem 1.5rem; border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 8px; transition: all 0.3s;">Prozessautomatisierung</a>
        <a href="/produkte.html#datenverarbeitung" style="color: #60a5fa; text-decoration: none; font-size: 1.1rem; padding: 0.75rem 1.5rem; border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 8px; transition: all 0.3s;">Datenverarbeitung</a>
        <a href="/kontakt.html" style="color: #60a5fa; text-decoration: none; font-size: 1.1rem; padding: 0.75rem 1.5rem; border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 8px; transition: all 0.3s;">Kontakt</a>
      </div>
    </section>
  </div>

  <!-- Workflow Modal -->
  <div id="workflow-modal">
    <div id="workflow-iframe-container">
      <button id="workflow-close-btn" data-i18n-aria-label="modal.close" aria-label="Schlie√üen">&times;</button>
      <div class="loading-indicator" id="loading-indicator" style="display: none;">
        <!-- Loading wird per JavaScript gesetzt -->
      </div>
      <iframe 
        id="workflow-iframe"
        title="Workflow"
        allow="camera; microphone; clipboard-write"
        sandbox="allow-same-origin allow-scripts allow-forms allow-popups"
      ></iframe>
    </div>
  </div>

  <!-- JavaScript for Modal Handling -->
  <script>
    // ========================================
    // HELPER FUNCTIONS (m√ºssen VOR openWorkflowModal sein!)
    // ========================================
    
    // Helper-Funktion f√ºr Loading-States mit Progress-Balken
      function showErrorState(loadingElement, errorMessage, errorDetails = null) {
        const lang = window.i18n?.getCurrentLanguage() || 'de';
        
        // Parse error message to extract main message and details
        let mainMessage = errorMessage;
        let statusCode = null;
        let errorType = window.i18n?.t('modal.error.general') || 'Fehler';
        
        // Extract HTTP status codes
        const httpMatch = errorMessage.match(/HTTP\s+(\d+):\s*(.+)/);
        if (httpMatch) {
          statusCode = httpMatch[1];
          const statusText = httpMatch[2];
          mainMessage = statusText;
          
          if (statusCode === '500') {
            errorType = window.i18n?.t('modal.error.server') || 'Server-Fehler';
            mainMessage = window.i18n?.t('modal.error.serverMessage') || 'Der Server konnte die Anfrage nicht verarbeiten. Bitte versuchen Sie es sp√§ter erneut.';
          } else if (statusCode === '404') {
            errorType = window.i18n?.t('modal.error.notFound') || 'Nicht gefunden';
            mainMessage = window.i18n?.t('modal.error.notFoundMessage') || 'Die angeforderte Ressource wurde nicht gefunden.';
          } else if (statusCode === '503') {
            errorType = window.i18n?.t('modal.error.serviceUnavailable') || 'Service nicht verf√ºgbar';
            mainMessage = window.i18n?.t('modal.error.serviceUnavailableMessage') || 'Der Service ist derzeit nicht verf√ºgbar. Bitte versuchen Sie es sp√§ter erneut.';
          }
        }
        
        // Extract other common error patterns
        if (errorMessage.includes('Timeout')) {
          errorType = window.i18n?.t('modal.error.timeout') || 'Zeit√ºberschreitung';
          mainMessage = window.i18n?.t('modal.error.timeoutMessage') || 'Die Anfrage hat zu lange gedauert. Bitte versuchen Sie es erneut.';
        } else if (errorMessage.includes('Failed to fetch') || errorMessage.includes('NetworkError')) {
          errorType = window.i18n?.t('modal.error.connection') || 'Verbindungsfehler';
          mainMessage = window.i18n?.t('modal.error.connectionMessage') || 'Verbindung zum Server fehlgeschlagen. Bitte pr√ºfen Sie Ihre Internetverbindung.';
        } else if (errorMessage.includes('CORS')) {
          errorType = window.i18n?.t('modal.error.cors') || 'Verbindungsfehler';
          mainMessage = window.i18n?.t('modal.error.corsMessage') || 'Verbindung zum Server wurde blockiert. Bitte pr√ºfen Sie die n8n Konfiguration.';
        }
        
        // Build error HTML
        loadingElement.innerHTML = `
          <div class="loading-content error-state">
            <div class="error-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <h3 class="error-title">${errorType}</h3>
            <p class="error-message">${mainMessage}</p>
            ${errorDetails ? `<div class="error-details">${errorDetails}</div>` : ''}
          </div>
        `;
      }
      
      function updateLoadingState(loadingElement, stage, progress) {
      const lang = window.i18n?.getCurrentLanguage() || 'de';
      const stages = {
        'start': { 
          text: window.i18n?.t('modal.loading.start') || 'üîÑ KI-Extraktion startet...', 
          stage: window.i18n?.t('modal.loading.stage.preparation') || 'Vorbereitung' 
        },
        'processing': { 
          text: window.i18n?.t('modal.loading.processing') || '‚öôÔ∏è KI analysiert Visitenkarte...', 
          stage: window.i18n?.t('modal.loading.stage.processing') || 'Verarbeitung' 
        },
        'waiting': { 
          text: window.i18n?.t('modal.loading.waiting') || '‚è≥ Warte auf Ergebnisse...', 
          stage: window.i18n?.t('modal.loading.stage.waiting') || 'Warten' 
        },
        'finalizing': { 
          text: window.i18n?.t('modal.loading.finalizing') || '‚ú® Extrahiere Kontaktdaten...', 
          stage: window.i18n?.t('modal.loading.stage.finalizing') || 'Finalisierung' 
        }
      };
      
      const stageInfo = stages[stage] || stages['processing'];
      
      loadingElement.innerHTML = `
        <div class="loading-content">
          <div class="spinner"></div>
          <p class="loading-text">${stageInfo.text}</p>
          <div class="loading-stage">${stageInfo.stage}</div>
          <div class="progress-bar-container">
            <div class="progress-bar" style="width: ${progress}%"></div>
          </div>
        </div>
      `;
    }
    
    // Helper-Funktion f√ºr Success-Indicator
    function showSuccessIndicator(loadingElement, message = null) {
      const lang = window.i18n?.getCurrentLanguage() || 'de';
      const successMessage = message || (window.i18n?.t('modal.success.extracted') || 'Daten erfolgreich extrahiert!');
      const closingMessage = window.i18n?.t('modal.success.closing') || 'Schlie√üe automatisch...';
      
      loadingElement.innerHTML = `
        <div class="success-indicator">
          <div class="success-content">
            <div class="success-icon">‚úì</div>
            <p class="success-text">${successMessage}</p>
            <p class="success-message">${closingMessage}</p>
          </div>
        </div>
      `;
    }
    
    // Funktion zum Scrollen zur Tabelle
    function scrollToResults() {
      // Versuche verschiedene Selektoren f√ºr die Results-Section
      const resultsSection = document.getElementById('results-section') || 
                             document.querySelector('[id*="results"]') ||
                             document.querySelector('.results-container') ||
                             document.querySelector('#results-table')?.closest('div') ||
                             document.querySelector('table#results-table')?.closest('div');
      
      if (resultsSection) {
        // Smooth Scroll mit Offset f√ºr bessere Sichtbarkeit
        setTimeout(() => {
          resultsSection.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
          });
          
          // Optional: Highlight-Animation f√ºr die Tabelle
          const resultsTable = document.getElementById('results-table');
          if (resultsTable) {
            resultsTable.style.transition = 'box-shadow 0.3s ease';
            resultsTable.style.boxShadow = '0 0 20px rgba(34, 197, 94, 0.5)';
            setTimeout(() => {
              resultsTable.style.boxShadow = '';
            }, 2000);
          }
        }, 100);
      } else {
        // Fallback: Scrolle einfach zur Tabelle
        const resultsTable = document.getElementById('results-table');
        if (resultsTable) {
          setTimeout(() => {
            resultsTable.scrollIntoView({ 
              behavior: 'smooth', 
              block: 'start' 
            });
            resultsTable.style.transition = 'box-shadow 0.3s ease';
            resultsTable.style.boxShadow = '0 0 20px rgba(34, 197, 94, 0.5)';
            setTimeout(() => {
              resultsTable.style.boxShadow = '';
            }, 2000);
          }, 100);
        }
      }
    }
    
    // ========================================
    // MODAL FUNCTIONS
    // ========================================
    
    async function openWorkflowModal(workflowUrl, workflowTitle, uploadFile = null, clickedLink = null) {
      const modal = document.getElementById('workflow-modal');
      const iframe = document.getElementById('workflow-iframe');
      const loading = document.getElementById('loading-indicator');
      
      // Variablen f√ºr Error-Handling initialisieren
      let webhookUrl = workflowUrl; // Initialwert
      let sampleParam = null; // Initialwert
      
      // Validierung - pr√ºfe ob URL konfiguriert ist
      if (!workflowUrl) {
        alert('‚ö†Ô∏è Workflow-URL ist nicht konfiguriert!');
        return;
      }
      
      // Zeige Modal sofort mit Smooth Animation - VERHINDERE wei√ües Bild
      modal.style.display = 'flex';
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
      
      // Zeige Loading-Indicator SOFORT (verhindert wei√ües Bild)
      loading.style.display = 'block';
      updateLoadingState(loading, 'start', 0);
      
      try {
        // DEBUG: Log workflowTitle um zu sehen was √ºbergeben wird
        console.log('üîç openWorkflowModal aufgerufen:', { workflowUrl, workflowTitle, uploadFile: !!uploadFile, clickedLink: !!clickedLink });
        
        // FIX: Wenn Link direkt √ºbergeben wurde, nutze ihn direkt!
        // Das verhindert den FALLBACK der immer Sample 1 nimmt
        let activeLink = clickedLink;
        
        // Nur wenn kein Link √ºbergeben wurde, suche nach Titel
        if (!activeLink && workflowTitle) {
          // Suche nach exaktem Match
          activeLink = document.querySelector(`.demo-card-link[data-title="${workflowTitle}"]`);
          
          // FALLBACK: Wenn kein exakter Link gefunden, versuche √§hnliche Titel
          if (!activeLink) {
            console.warn('‚ö†Ô∏è Kein exakter Link gefunden f√ºr:', workflowTitle);
            
            // Suche alle Links und finde den mit √§hnlichem Titel
            const allLinks = document.querySelectorAll('.demo-card-link');
            for (const link of allLinks) {
              const linkTitle = link.getAttribute('data-title') || '';
              // Pr√ºfe ob Titel √§hnlich ist (z.B. "Visitenkarten Demo ‚Äì Sample 1" vs "Visitenkarten Demo ‚Äì Sample 1")
              if (linkTitle.includes(workflowTitle) || workflowTitle.includes(linkTitle)) {
                activeLink = link;
                console.log('‚úÖ √Ñhnlicher Link gefunden:', {
                  workflowTitle,
                  linkTitle,
                  params: link.getAttribute('data-params')
                });
                break;
              }
            }
          }
        }
        
        // Falls kein Link gefunden (z.B. bei Upload), versuche alternativen Selector
        const ownCardTitleCheck = window.i18n?.t('modal.upload.ownCard') || 'Eigene Visitenkarte hochladen';
        if (!activeLink && workflowTitle === ownCardTitleCheck) {
          // F√ºr Upload gibt es keinen data-title, aber wir haben kein sample-Parameter
          activeLink = null;
          console.log('üì§ Upload-Modus: kein sample-Parameter');
        }
        
        // WICHTIG: Falls immer noch kein Link gefunden, FEHLER melden
        // ENTFERNT: FALLBACK der immer Sample 1 nimmt - das war das Problem!
        if (!activeLink && !uploadFile) {
          console.error('‚ùå KRITISCH: Kein Link gefunden f√ºr:', workflowTitle);
          console.error('üîç Alle verf√ºgbaren Links:');
          const allLinks = document.querySelectorAll('.demo-card-link');
          allLinks.forEach((link, index) => {
            console.error(`Link ${index}:`, {
              title: link.getAttribute('data-title'),
              params: link.getAttribute('data-params'),
              url: link.getAttribute('data-workflow-url')
            });
          });
          // KEIN FALLBACK MEHR - Fehler wird gemeldet, aber Workflow l√§uft nicht mit falschen Daten
          const linkNotFoundMsg = window.i18n?.t('modal.error.linkNotFound') || '‚ö†Ô∏è Fehler: Konnte den korrekten Link nicht finden. Bitte Seite neu laden und erneut versuchen.';
          alert(linkNotFoundMsg);
          closeWorkflowModal();
          return;
        }
        
        console.log('üîç Gefundener Link:', {
          found: !!activeLink,
          workflowTitle,
          linkTitle: activeLink?.getAttribute('data-title'),
          linkParams: activeLink?.getAttribute('data-params'),
          isClickedLink: activeLink === clickedLink,
          clickedLinkParams: clickedLink?.getAttribute('data-params'),
          clickedLinkTitle: clickedLink?.getAttribute('data-title')
        });
        
        // KRITISCH: Pr√ºfe ob activeLink korrekt ist
        if (!activeLink && !uploadFile) {
          console.error('‚ùå KRITISCH: activeLink ist null!');
          console.error('üìã clickedLink:', clickedLink);
          console.error('üìã workflowTitle:', workflowTitle);
        }
        
        // KRITISCH: extraParams aus activeLink ODER clickedLink lesen!
        // PRIORIT√ÑT 1: clickedLink (direkt geklickt)
        // PRIORIT√ÑT 2: activeLink (gefunden durch Suche)
        let extraParams = '';
        
        if (clickedLink && !uploadFile) {
          // PRIORIT√ÑT 1: clickedLink hat immer Vorrang!
          extraParams = clickedLink.getAttribute('data-params') || '';
          console.log('‚úÖ Extra Params aus clickedLink:', extraParams);
        } else if (activeLink && !uploadFile) {
          // PRIORIT√ÑT 2: activeLink als Fallback
          extraParams = activeLink.getAttribute('data-params') || '';
          console.log('‚úÖ Extra Params aus activeLink:', extraParams);
        }
        
        // KRITISCH: Wenn extraParams leer ist, WORKFLOW STOPPEN!
        if (!extraParams && !uploadFile) {
          console.error('‚ùå KRITISCH: extraParams ist leer! Workflow wird GESTOPPT!');
          console.error('üìã activeLink:', activeLink);
          console.error('üìã clickedLink:', clickedLink);
          console.error('üìã activeLink?.getAttribute("data-params"):', activeLink?.getAttribute('data-params'));
          console.error('üìã clickedLink?.getAttribute("data-params"):', clickedLink?.getAttribute('data-params'));
          console.error('üìã workflowTitle:', workflowTitle);
          
          const sampleMissingMsg = window.i18n?.t('modal.error.sampleMissing') || '‚ö†Ô∏è KRITISCH: Sample-Parameter fehlt!\n\nDer Workflow kann nicht gestartet werden, da kein sample-Parameter gefunden wurde.\n\nBitte:\n1. Seite neu laden\n2. Erneut versuchen\n\nWenn das Problem weiterhin besteht, kontaktieren Sie den Support.';
          alert(sampleMissingMsg);
          closeWorkflowModal();
          return; // WORKFLOW STOPPEN - kein leerer Parameter wird gesendet!
        }
        
        console.log('üìã Extra Params (final):', extraParams);
        
        // KRITISCH: Pr√ºfe ob extraParams den sample-Parameter enth√§lt!
        if (!extraParams.includes('sample=') && !uploadFile) {
          console.error('‚ùå KRITISCH: extraParams enth√§lt KEINEN sample-Parameter!');
          console.error('üìã extraParams:', extraParams);
          
          const sampleMissingExtraMsg = window.i18n?.t('modal.error.sampleMissingExtra') || '‚ö†Ô∏è KRITISCH: Sample-Parameter fehlt in extraParams!\n\nDer Workflow kann nicht gestartet werden.\n\nBitte Seite neu laden und erneut versuchen.';
          alert(sampleMissingExtraMsg);
          closeWorkflowModal();
          return; // WORKFLOW STOPPEN - kein leerer Parameter wird gesendet!
        }
        
        // Extrahiere sample-Parameter (z.B. "sample=1" -> "1")
        const sampleParam = extraParams.includes('sample=') 
          ? extraParams.split('sample=')[1]?.split('&')[0] || null
          : null;
        console.log('üìù Sample Parameter:', sampleParam);
        
        // Baue Webhook-URL mit Parametern
        // extraParams sollte jetzt IMMER vorhanden sein (wurde oben gepr√ºft)
        // WICHTIG: let verwenden, da webhookUrl sp√§ter √ºberschrieben wird (ohne Query-Parameter)
        let webhookUrl = extraParams
          ? `${workflowUrl}${workflowUrl.includes('?') ? '&' : '?'}${extraParams}`
          : workflowUrl;
        console.log('üåê Final Webhook URL:', webhookUrl);
        
        // HINWEIS: Die Webhook-URL wird sp√§ter auf workflowUrl gesetzt (ohne Query-Parameter),
        // da wir POST mit JSON-Body verwenden. Die URL-Pr√ºfung ist daher nicht mehr n√∂tig.
        
        // Detailliertes Logging starten
        const logTimestamp = new Date().toISOString();
        const logId = `workflow-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        
        // Log-Objekt f√ºr persistente Speicherung
        const workflowLog = {
          id: logId,
          timestamp: logTimestamp,
          workflowUrl: webhookUrl,
          sampleParam: sampleParam || 'Upload',
          workflowTitle: workflowTitle,
          method: 'POST', // IMMER POST VERWENDEN
          status: 'started',
          events: [],
          errors: [],
          response: null,
          duration: null
        };
        
        // Speichere Log in localStorage
        const storedLogs = JSON.parse(localStorage.getItem('workflowLogs') || '[]');
        storedLogs.unshift(workflowLog);
        // Behalte nur die letzten 50 Logs
        if (storedLogs.length > 50) {
          storedLogs.pop();
        }
        localStorage.setItem('workflowLogs', JSON.stringify(storedLogs));
        
        console.group(`üöÄ Workflow gestartet [${logId}]`);
        console.log('‚è∞ Zeitstempel:', logTimestamp);
        console.log('üåê Webhook URL:', webhookUrl);
        console.log('üìù Sample Parameter:', sampleParam || 'Upload');
        console.log('üìã Workflow Titel:', workflowTitle);
        
        // Helper-Funktion zum Hinzuf√ºgen von Log-Events
        function addLogEvent(type, data) {
          workflowLog.events.push({
            type: type,
            timestamp: new Date().toISOString(),
            data: data
          });
          // Update in localStorage
          const logs = JSON.parse(localStorage.getItem('workflowLogs') || '[]');
          const logIndex = logs.findIndex(l => l.id === logId);
          if (logIndex !== -1) {
            logs[logIndex] = workflowLog;
            localStorage.setItem('workflowLogs', JSON.stringify(logs));
          }
        }
        
        // Triggere Workflow im Hintergrund
        // IMMER POST verwenden (f√ºr Samples und Upload)
        const method = 'POST'; // IMMER POST VERWENDEN
        let fetchOptions = {
          method: method,
        };
        
        // F√ºr POST: Entweder File-Upload oder Sample-JSON
        if (method === 'POST') {
          let fileToUpload = uploadFile;
          
          // Falls kein File als Parameter √ºbergeben wurde, pr√ºfe File Input
          if (!fileToUpload) {
            const fileInput = document.getElementById('business-card-upload-input');
            if (fileInput && fileInput.files && fileInput.files.length > 0) {
              fileToUpload = fileInput.files[0];
            }
          }
          
          if (fileToUpload) {
            // FALL 1: Datei-Upload
            const formData = new FormData();
            formData.append('file', fileToUpload);
            fetchOptions.body = formData;
            fetchOptions.headers = {}; // FormData setzt Content-Type
            console.log('üìé Sende File:', fileToUpload.name, fileToUpload.size, 'bytes');

            // WICHTIG: Webhook URL f√ºr Upload darf KEINE extraParams haben
            webhookUrl = workflowUrl;

          } else if (extraParams) {
            // FALL 2: Sample-Demo (JSON senden)
            fetchOptions.body = JSON.stringify({
              "query": {
                "sample": sampleParam
              }
            });
            fetchOptions.headers = {
              'Content-Type': 'application/json'
            };
            console.log('üìù Sende Sample JSON:', fetchOptions.body);

            // WICHTIG: Webhook URL f√ºr Sample darf KEINE extraParams haben
            webhookUrl = workflowUrl;

          } else {
            // Fall 3: Normaler POST ohne Body (sollte nicht vorkommen)
            fetchOptions.headers = {
              'Content-Type': 'application/json'
            };
          }
        }
        
        const requestData = {
          method: fetchOptions.method,
          url: webhookUrl,
          hasBody: !!fetchOptions.body,
          headers: fetchOptions.headers,
          bodyType: fetchOptions.body ? (fetchOptions.body instanceof FormData ? 'FormData' : 'JSON') : 'none'
        };
        addLogEvent('request', requestData);
        
        console.log('üåê Sende Request:', requestData);
        
        // Performance-Tracking
        const requestStartTime = performance.now();
        
        // TIMEOUT: 30 Sekunden f√ºr n8n Workflow
        const TIMEOUT_MS = 30000; // 30 Sekunden
        
        // Helper-Funktion f√ºr Timeout
        function fetchWithTimeout(url, options, timeoutMs) {
          return new Promise((resolve, reject) => {
            const timeoutId = setTimeout(() => {
              reject(new Error(`Timeout: Der Workflow hat nach ${timeoutMs / 1000} Sekunden nicht geantwortet. Bitte pr√ºfen Sie den n8n Server oder versuchen Sie es erneut.`));
            }, timeoutMs);
            
            fetch(url, options)
              .then(response => {
                clearTimeout(timeoutId);
                resolve(response);
              })
              .catch(error => {
                clearTimeout(timeoutId);
                reject(error);
              });
          });
        }
        
        // Update Loading mit Timeout-Info (Progress-Balken anzeigen)
        updateLoadingState(loading, 'processing', 30);
        
        let response;
        try {
          console.log('üöÄ Starte fetch zu:', webhookUrl);
          response = await fetchWithTimeout(webhookUrl, fetchOptions, TIMEOUT_MS);
          console.log('‚úÖ Response erhalten:', response.status, response.statusText);
        } catch (fetchError) {
          console.error('‚ùå Fetch Fehler:', fetchError);
          
          // Detaillierte Fehlermeldung
          let errorMessage = 'Failed to fetch';
          const isUpload = method === 'POST' && fetchOptions.body instanceof FormData;
          
          if (fetchError.message) {
            errorMessage = fetchError.message;
            // Pr√ºfe ob es ein Timeout ist
            if (fetchError.message.includes('Timeout')) {
              errorMessage = `‚è±Ô∏è Timeout: Der n8n Workflow hat nach ${TIMEOUT_MS / 1000} Sekunden nicht geantwortet.\n\nM√∂gliche Ursachen:\n1. n8n Server ist √ºberlastet\n2. Workflow ist zu komplex und braucht l√§nger\n3. n8n Server ist offline\n4. Netzwerkprobleme\n\nBitte versuchen Sie es erneut oder pr√ºfen Sie den n8n Server.`;
            }
          } 
          
          // Spezielle Fehlermeldung f√ºr Upload-Probleme
          if (isUpload && (fetchError.name === 'TypeError' || fetchError.message?.includes('Failed to fetch'))) {
            errorMessage = `‚ùå Upload-Fehler: Die Datei konnte nicht an den n8n Server gesendet werden.\n\nM√∂gliche Ursachen:\n1. n8n Webhook akzeptiert keine Datei-Uploads\n2. CORS-Fehler (Cross-Origin Request Blocked)\n3. n8n Server ist offline oder nicht erreichbar\n4. Netzwerk-Problem\n5. Datei ist zu gro√ü (max. 10 MB)\n\nBitte pr√ºfen Sie:\n- n8n Workflow ist aktiviert\n- Webhook-URL: ${webhookUrl}\n- Browser-Konsole f√ºr weitere Details\n\nTipp: √ñffnen Sie die Browser-Konsole (F12) f√ºr detaillierte Fehlerinformationen.`;
          } else if (!isUpload && fetchError.name === 'TypeError' && fetchError.message && fetchError.message.includes('Failed to fetch')) {
            errorMessage = 'CORS-Fehler oder Netzwerk-Problem. Pr√ºfe ob n8n Webhook erreichbar ist.\n\nM√∂gliche L√∂sungen:\n1. n8n Workflow ist nicht aktiviert\n2. Webhook-URL ist falsch\n3. CORS ist nicht konfiguriert\n4. n8n Server ist offline';
          }
          
          // Zeige detaillierte Fehlerinformationen
          console.error('üîç Debug Info:', {
            workflowUrl: webhookUrl,
            method: fetchOptions.method,
            hasBody: !!fetchOptions.body,
            error: fetchError,
            timeout: TIMEOUT_MS
          });
          
          // Zeige Fehler-State
          showErrorState(loading, errorMessage, 'Bitte versuchen Sie es erneut oder kontaktieren Sie den Support.');
          
          throw new Error(errorMessage);
        }
        
        const requestDuration = (performance.now() - requestStartTime).toFixed(2);
        workflowLog.duration = `${requestDuration}ms`;
        
        const responseData_log = {
          status: response.status,
          statusText: response.statusText,
          ok: response.ok,
          headers: Object.fromEntries(response.headers.entries()),
          duration: `${requestDuration}ms`,
          timestamp: new Date().toISOString()
        };
        addLogEvent('response', responseData_log);
        
        console.log('‚úÖ Response erhalten:', responseData_log);
        
        if (!response.ok) {
          const errorText = await response.text().catch(() => 'Keine Details');
          const errorData = {
            status: response.status,
            statusText: response.statusText,
            body: errorText,
            type: 'http_error'
          };
          workflowLog.errors.push(errorData);
          workflowLog.status = 'error';
          addLogEvent('error', errorData);
          
          // Update in localStorage
          const logs = JSON.parse(localStorage.getItem('workflowLogs') || '[]');
          const logIndex = logs.findIndex(l => l.id === logId);
          if (logIndex !== -1) {
            logs[logIndex] = workflowLog;
            localStorage.setItem('workflowLogs', JSON.stringify(logs));
          }
          
          console.error('‚ùå HTTP Fehler:', errorData);
          
          // Zeige Fehler-State
          const httpErrorMsg = `HTTP ${response.status}: ${response.statusText}`;
          const httpErrorDetails = errorText && errorText !== 'Keine Details' ? `Details: ${errorText.substring(0, 200)}` : null;
          showErrorState(loading, httpErrorMsg, httpErrorDetails);
          
          throw new Error(`HTTP ${response.status}: ${response.statusText}\n${errorText}`);
        }
        
        const responseData = await response.json().catch(async () => {
          // Falls keine JSON-Response, versuche Text
          const text = await response.text();
          console.warn('‚ö†Ô∏è Keine JSON-Response, erhalten:', text);
          return { message: text };
        });
        workflowLog.response = responseData;
        workflowLog.status = 'success';
        
        const responseStructure = {
          type: responseData.type || 'unknown',
          hasPayload: !!responseData.payload,
          isArray: Array.isArray(responseData),
          keys: Object.keys(responseData)
        };
        addLogEvent('response_parsed', responseStructure);
        
        // Update in localStorage
        const logs = JSON.parse(localStorage.getItem('workflowLogs') || '[]');
        const logIndex = logs.findIndex(l => l.id === logId);
        if (logIndex !== -1) {
          logs[logIndex] = workflowLog;
          localStorage.setItem('workflowLogs', JSON.stringify(logs));
        }
        
        console.log('‚úÖ Workflow Response:', responseData);
        console.log('üìä Response Struktur:', responseStructure);
        
        // WICHTIG: n8n kann verschachtelte JSON-Strukturen zur√ºckgeben
        // Pr√ºfe ob Response verschachtelt ist (responseData.json.type statt responseData.type)
        let actualResponseData = responseData;
        if (responseData.json && typeof responseData.json === 'object') {
          // n8n gibt manchmal { json: { type: ..., payload: ... } } zur√ºck
          actualResponseData = responseData.json;
          console.log('üì¶ Verschachtelte Response erkannt, nutze responseData.json');
          console.log('üìä Tats√§chliche Response:', actualResponseData);
        }
        
        // Pr√ºfe ob Workflow nur gestartet wurde (asynchron)
        // WICHTIG: Bei "Workflow was started" m√ºssen wir auf die finale Response vom "Respond to Webhook" Node warten
        if (actualResponseData.message && actualResponseData.message.includes('Workflow was started')) {
          console.error('‚ö†Ô∏è Workflow l√§uft asynchron - ABER: Response sollte final sein!');
          console.error('üîß Problem: n8n Webhook Node ist NICHT auf "lastNode" eingestellt!');
          console.error('üìã Response:', actualResponseData);
          
          // Zeige statisches Workflow-Screenshot UND Loading-Indicator (Workflow l√§uft noch!)
          loading.style.display = 'block';
          updateLoadingState(loading, 'waiting', 60);
          iframe.srcdoc = `
            <html>
              <head>
                <style>
                  * { box-sizing: border-box; }
                  body {
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    margin: 0;
                    padding: 1rem;
                    background: linear-gradient(135deg, #0a1628 0%, #09182F 100%);
                    color: white;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    height: 100vh;
                    overflow: hidden;
                  }
                  .header {
                    text-align: center;
                    padding: 1rem 1rem 0.5rem;
                    flex-shrink: 0;
                  }
                  h2 { 
                    margin: 0 0 0.75rem; 
                    font-size: 2rem;
                    line-height: 1.2;
                    font-weight: 700;
                    background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                  }
                  .subtitle { 
                    color: #cbd5e1; 
                    font-size: 1.2rem;
                    margin: 0;
                    font-weight: 500;
                  }
                  .media-container {
                    flex: 1;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    width: 100%;
                    min-height: 0;
                    padding: 1rem;
                    overflow: auto;
                    background: rgba(0, 0, 0, 0.2);
                    border-radius: 12px;
                  }
                  .media-container img {
                    max-width: 100%;
                    max-height: 100%;
                    width: auto;
                    height: auto;
                    border-radius: 12px;
                    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
                    object-fit: contain;
                    border: 2px solid rgba(148, 163, 184, 0.2);
                  }
                  .info-text {
                    text-align: center;
                    padding: 0.75rem 1rem 1rem;
                    color: #94a3b8;
                    font-size: 0.85rem;
                    flex-shrink: 0;
                    margin: 0;
                    line-height: 1.5;
                  }
                  .warning {
                    color: #fbbf24;
                    font-size: 0.8rem;
                    margin-top: 0.5rem;
                  }
                </style>
              </head>
              <body>
                <div class="header">
                  <h2 data-i18n="modal.workflow.started">‚úÖ Workflow erfolgreich gestartet</h2>
                  <p class="subtitle" data-i18n="modal.workflow.visualization">n8n Workflow-Visualisierung</p>
                </div>
                <div class="media-container">
                  <img src="assets/workflow-demo.png" 
                       alt="n8n Workflow Visualisierung" 
                       style="display: block;"
                       onerror="this.style.display='none'; const screenshotError = window.i18n?.t('modal.error.screenshotError') || '‚ö†Ô∏è Screenshot konnte nicht geladen werden'; this.parentElement.innerHTML='<div style=\\'color: #94a3b8; text-align: center;\\'>' + screenshotError + '</div>';">
                </div>
                <div class="info-text" data-i18n="modal.workflow.background">
                  ${window.i18n?.t('modal.workflow.background') || 'Die Extraktion l√§uft im Hintergrund. Ergebnisse erscheinen automatisch in der Tabelle.'}
                  <div class="warning">
                    ${window.i18n?.t('modal.workflow.async') || '‚ö†Ô∏è Workflow antwortet asynchron - pr√ºfe n8n Execution Logs falls keine Ergebnisse kommen'}
                  </div>
                </div>
              </body>
            </html>
          `;
          
          // WICHTIG: Der Workflow sollte die Daten √ºber "Respond to Webhook" zur√ºckgeben
          // Falls das nicht funktioniert, m√ºssen wir die n8n Workflow-Konfiguration pr√ºfen
          console.warn('‚ö†Ô∏è Workflow antwortet asynchron. Pr√ºfe n8n Workflow-Konfiguration:');
          console.warn('1. Webhook Node sollte "responseMode: lastNode" haben');
          console.warn('2. "Respond to Webhook" Node sollte am Ende des Workflows sein');
          console.warn('3. "Respond to Webhook" Node sollte die extrahierten Daten zur√ºckgeben');
          
          // Logge Warnung
          addLogEvent('warning', {
            message: 'Workflow l√§uft asynchron',
            response: responseData,
            note: 'Erwarte finale Antwort vom Workflow'
          });
          
          // FALLBACK: Wenn "Workflow was started" kommt und keine finalen Daten, schlie√üe Modal nach 5 Sekunden
          console.warn('‚è±Ô∏è Fallback: Schlie√üe Modal nach 5 Sekunden, da nur "Workflow was started" kam');
          setTimeout(() => {
            if (!dataProcessed) {
              closeWorkflowModal();
              console.warn('‚ö†Ô∏è Modal geschlossen - keine finalen Daten vom Workflow erhalten');
              alert('‚ö†Ô∏è Der n8n Workflow hat nur "Workflow was started" zur√ºckgegeben, aber keine finalen Daten.\n\nBitte pr√ºfe:\n1. n8n Webhook Node ‚Üí "Response Mode" = "lastNode"\n2. "Respond to Webhook" Node ‚Üí Muss am Ende des Workflows sein\n3. n8n Execution Logs ‚Üí Pr√ºfe ob "Respond to Webhook" ausgef√ºhrt wurde');
            }
          }, 5000);
          
          // KEIN RETURN - lass den Code weiterlaufen, falls sp√§ter doch Daten kommen
        }
        
        // WICHTIG: n8n gibt die Response oft als Array zur√ºck: [{type: 'business-card-processed', payload: {...}}]
        // ZUERST Array pr√ºfen, DANN Objekt pr√ºfen
        let dataProcessed = false;
        
        // Wenn Response ein Array ist (n8n gibt oft Arrays zur√ºck)
        if (Array.isArray(responseData) && responseData.length > 0) {
          console.log('üì¶ Array-Response erkannt:', responseData.length, 'Elemente');
          responseData.forEach((item, index) => {
            // Pr√ºfe auf verschachtelte Struktur (item.json) oder direkte Struktur (item)
            const itemData = item.json || item;
            console.log(`üìã Array-Item ${index}:`, itemData);
            
            // Pr√ºfe ob Item die richtige Struktur hat
            const itemType = itemData.type;
            const itemPayload = itemData.payload;
            
            if (itemType === 'business-card-processed' && itemPayload) {
              const p = itemPayload;
          extractedResults.unshift({
            name: p.name || '',
            company: p.company || '',
            email: p.email || '',
            phone: p.phone || '',
            address: p.address || '',
            city: p.city || '',
            website: p.website || p.url || '',
            source: p.source || (p.sample ? `Sample ${p.sample}` : 'Upload'),
            timestamp: p.timestamp || new Date().toISOString()
          });
              dataProcessed = true;
              console.log(`‚úÖ Array-Item ${index} verarbeitet:`, {
                name: p.name || '(leer)',
                company: p.company || '(leer)',
                email: p.email || '(leer)'
              });
            } else if (itemType === 'error') {
              // Fehler-Response behandeln
              console.error(`‚ùå Fehler in Array-Item ${index}:`, itemData);
              const errorMsg = itemData.message || itemData.error || 'Unbekannter Fehler';
              showErrorState(loading, errorMsg, 'Bitte pr√ºfen Sie die n8n Execution Logs f√ºr weitere Details.');
              iframe.style.display = 'none';
              dataProcessed = true; // Fehler wurde behandelt
            } else {
              console.warn(`‚ö†Ô∏è Array-Item ${index} hat nicht die erwartete Struktur:`, {
                type: itemType,
                hasPayload: !!itemPayload,
                itemData: itemData
              });
            }
          });
          
          if (dataProcessed) {
            // Zeige Success-Indicator
            showSuccessIndicator(loading);
            
          renderResults();
            console.log(`‚úÖ Array-Daten erfolgreich in Tabelle eingef√ºgt: ${responseData.length} Eintr√§ge`);
            
            // Auto-Close Modal nach 1.5 Sekunden und scrollen zur Tabelle
            setTimeout(() => {
              closeWorkflowModal();
              scrollToResults();
              console.log('‚úÖ Modal automatisch geschlossen nach erfolgreicher Array-Extraktion');
            }, 1500);
          }
        }
        
        // Wenn Response KEIN Array ist, pr√ºfe als Objekt (f√ºr Upload oder direkte Responses)
        if (!dataProcessed && !Array.isArray(responseData)) {
          // Pr√ºfe sowohl normale als auch verschachtelte Struktur
          const responseType = actualResponseData.type || responseData.type;
          const responsePayload = actualResponseData.payload || responseData.payload;
          
          if (responseType === 'business-card-processed' && responsePayload) {
            const p = responsePayload;
              extractedResults.unshift({
                name: p.name || '',
                company: p.company || '',
                email: p.email || '',
                phone: p.phone || '',
                address: p.address || '',
                city: p.city || '',
                website: p.website || p.url || '',
                source: p.source || (p.sample ? `Sample ${p.sample}` : 'Upload'),
                timestamp: p.timestamp || new Date().toISOString()
              });
            
            // Zeige Success-Indicator
            showSuccessIndicator(loading);
            
            renderResults();
            console.log('‚úÖ Objekt-Daten in Tabelle eingef√ºgt:', {
              name: p.name || '(leer)',
              company: p.company || '(leer)',
              email: p.email || '(leer)',
              source: p.source || (p.sample ? `Sample ${p.sample}` : 'Upload')
            });
            
            // Auto-Close Modal nach 1.5 Sekunden und scrollen zur Tabelle
            setTimeout(() => {
              closeWorkflowModal();
              scrollToResults();
              console.log('‚úÖ Modal automatisch geschlossen nach erfolgreicher Extraktion');
            }, 1500);
            dataProcessed = true;
          } else if (responseType === 'error') {
            // Fehler-Response behandeln
            console.error('‚ùå Fehler-Response erhalten:', actualResponseData);
            const errorMsg = actualResponseData.message || actualResponseData.error || 'Unbekannter Fehler';
            showErrorState(loading, errorMsg, 'Bitte pr√ºfen Sie die n8n Execution Logs f√ºr weitere Details.');
            iframe.style.display = 'none';
            dataProcessed = true; // Fehler wurde behandelt
          }
        }
        
        // Falls keine Daten kamen, aber auch keine "Workflow was started" Message
        // UND: Daten wurden NICHT verarbeitet
        if (!dataProcessed) {
          const hasType = actualResponseData.type || responseData.type;
          const hasMessage = actualResponseData.message || responseData.message;
          const isArray = Array.isArray(responseData);
          
          if (!hasType && !hasMessage && !isArray) {
            console.warn('‚ö†Ô∏è Unerwartete Response-Struktur:', responseData);
          console.warn('üìã Vollst√§ndige Response-Struktur:', {
            keys: Object.keys(responseData),
            type: responseData.type,
            actualType: actualResponseData.type,
            hasJson: !!responseData.json,
            structure: JSON.stringify(responseData, null, 2)
          });
            updateLoadingState(loading, 'waiting', 80);
            
            // FALLBACK: Schlie√üe Modal nach 5 Sekunden wenn keine Daten kamen
            console.warn('‚è±Ô∏è Fallback: Schlie√üe Modal nach 5 Sekunden, da keine Daten verarbeitet wurden');
            setTimeout(() => {
              if (!dataProcessed) {
                closeWorkflowModal();
                console.warn('‚ö†Ô∏è Modal geschlossen - keine Daten verarbeitet');
                alert('‚ö†Ô∏è Der n8n Workflow hat keine erwarteten Daten zur√ºckgegeben.\n\nBitte pr√ºfe:\n1. Browser-Konsole (F12) f√ºr Details\n2. n8n Execution Logs\n3. Webhook-URL ist korrekt\n4. Workflow ist aktiviert');
              }
            }, 5000);
          } else {
            // Response-Struktur war OK, aber keine Daten verarbeitet
            console.warn('‚ö†Ô∏è Response-Struktur OK, aber keine Daten verarbeitet:', {
              hasType,
              hasMessage,
              isArray,
              responseData
            });
            
            // FALLBACK: Schlie√üe Modal nach 5 Sekunden
            setTimeout(() => {
              if (!dataProcessed) {
                closeWorkflowModal();
                console.warn('‚ö†Ô∏è Modal geschlossen - Response-Struktur OK, aber keine Daten verarbeitet');
              }
            }, 5000);
          }
          
          // Zeige auch die Response-Struktur im Iframe f√ºr Debugging
          iframe.srcdoc = `
            <html>
              <head>
                <style>
                  body {
                    font-family: monospace;
                    background: #1e293b;
                    color: #e2e8f0;
                    padding: 2rem;
                    font-size: 0.9rem;
                  }
                  pre {
                    background: #0a1628;
                    padding: 1rem;
                    border-radius: 8px;
                    overflow: auto;
                    white-space: pre-wrap;
                  }
                </style>
              </head>
              <body>
                <h2 style="color: #fbbf24;">‚ö†Ô∏è Unerwartete Response-Struktur</h2>
                <p>Bitte pr√ºfen Sie die Browser-Konsole (F12) f√ºr Details.</p>
                <pre>${JSON.stringify(responseData, null, 2)}</pre>
              </body>
            </html>
          `;
        }
        
        console.groupEnd(); // Workflow-Log-Gruppe schlie√üen
        
        // Zeige Workflow-Visualisierung (Loading-State statt statischem Demo-Bild)
        if (responseData.executionUrl) {
          // Option 1: Falls n8n eine Execution-URL zur√ºckgibt, lade diese (echte Workflow-Visualisierung)
          iframe.src = responseData.executionUrl;
          loading.style.display = 'none'; // Verstecke Loading-Indicator wenn Iframe geladen wird
        } else {
          // Option 2: Zeige statisches Workflow-Screenshot im Iframe
          // WICHTIG: Verstecke Loading-Indicator √ºber Iframe, da Screenshot im Iframe ist
          loading.style.display = 'none';
          iframe.srcdoc = `
            <html>
              <head>
                <style>
                  * { box-sizing: border-box; }
                  body {
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    margin: 0;
                    padding: 1rem;
                    background: linear-gradient(135deg, #0a1628 0%, #09182F 100%);
                    color: white;
                    display: flex;
                    flex-direction: column;
                    height: 100vh;
                    overflow: hidden;
                  }
                  .header {
                    text-align: center;
                    padding: 1rem 1rem 0.5rem;
                    flex-shrink: 0;
                  }
                  h2 { 
                    margin: 0 0 0.75rem; 
                    font-size: 2rem;
                    line-height: 1.2;
                    font-weight: 700;
                    background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                  }
                  .subtitle { 
                    color: #cbd5e1; 
                    font-size: 1.2rem;
                    margin: 0;
                    font-weight: 500;
                  }
                  .media-container {
                    flex: 1;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    width: 100%;
                    min-height: 0;
                    padding: 1rem;
                    overflow: auto;
                    background: rgba(0, 0, 0, 0.2);
                    border-radius: 12px;
                  }
                  .media-container img {
                    max-width: 100%;
                    max-height: 100%;
                    width: auto;
                    height: auto;
                    border-radius: 12px;
                    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
                    object-fit: contain;
                    border: 2px solid rgba(148, 163, 184, 0.2);
                  }
                  .info-text {
                    text-align: center;
                    padding: 0.75rem 1rem 1rem;
                    color: #94a3b8;
                    font-size: 0.85rem;
                    flex-shrink: 0;
                    margin: 0;
                    line-height: 1.5;
                  }
                </style>
              </head>
              <body>
                <div class="header">
                  <h2 data-i18n="modal.workflow.started">‚úÖ Workflow erfolgreich gestartet</h2>
                  <p class="subtitle" data-i18n="modal.workflow.visualization">n8n Workflow-Visualisierung</p>
                </div>
                <div class="media-container">
                  <img src="assets/workflow-demo.png" 
                       alt="n8n Workflow Visualisierung" 
                       style="display: block;"
                       onerror="this.style.display='none'; const screenshotError = window.i18n?.t('modal.error.screenshotError') || '‚ö†Ô∏è Screenshot konnte nicht geladen werden'; this.parentElement.innerHTML='<div style=\\'color: #94a3b8; text-align: center;\\'>' + screenshotError + '</div>';">
                </div>
                <div class="info-text" data-i18n="modal.workflow.background">
                  ${window.i18n?.t('modal.workflow.background') || 'Die Extraktion l√§uft im Hintergrund. Ergebnisse erscheinen automatisch in der Tabelle.'}
                </div>
              </body>
            </html>
          `;
          
          // Loading-Indicator ist bereits versteckt
          // Statisches Workflow-Screenshot wird jetzt im Iframe angezeigt
        }
        
      } catch (error) {
          const errorTimestamp = new Date().toISOString();
          const errorDetails = {
            message: error.message || 'Unbekannter Fehler',
            name: error.name || 'Error',
            stack: error.stack || 'Kein Stack-Trace',
            workflowUrl: typeof webhookUrl !== 'undefined' ? webhookUrl : (workflowUrl || 'unbekannt'),
            sampleParam: typeof sampleParam !== 'undefined' ? (sampleParam || 'Upload') : 'unbekannt',
            type: 'exception',
            timestamp: errorTimestamp
          };
          
          // Speichere Fehler in Log
          if (typeof workflowLog !== 'undefined') {
            workflowLog.errors.push(errorDetails);
            workflowLog.status = 'error';
            
            // Update in localStorage
            const logs = JSON.parse(localStorage.getItem('workflowLogs') || '[]');
            const logIndex = logs.findIndex(l => l.id === logId);
            if (logIndex !== -1) {
              logs[logIndex] = workflowLog;
              localStorage.setItem('workflowLogs', JSON.stringify(logs));
            }
          }
          
          console.group('‚ùå Workflow Fehler');
          console.error('‚è∞ Zeitstempel:', errorTimestamp);
        console.error('‚ùå Fehler beim Triggern des Workflows:', error);
          console.error('üìã Fehler Details:', errorDetails);
          console.groupEnd();
          
          // Zeige Fehler-State im Loading-Indicator
          const errorMsg = error.message || 'Unbekannter Fehler';
          const errorHelpText = 'Tipp: √ñffnen Sie die Browser-Konsole (F12) f√ºr detaillierte Fehlerinformationen.';
          showErrorState(loading, errorMsg, errorHelpText);
          
          // Verstecke Iframe bei Fehler
          iframe.style.display = 'none';
      }
      
      // Analytics (optional)
      if (typeof gtag !== 'undefined') {
        gtag('event', 'workflow_opened', {
          'event_category': 'engagement',
          'event_label': workflowTitle,
          'workflow_url': workflowUrl
        });
      }
    }
    
    function closeWorkflowModal() {
      try {
      const modal = document.getElementById('workflow-modal');
        if (!modal) {
          console.error('‚ùå Modal nicht gefunden!');
          return;
        }
        
      const iframe = document.getElementById('workflow-iframe');
      
        // Modal schlie√üen - SICHERSTELLEN dass es funktioniert
      modal.classList.remove('active');
        modal.style.display = 'none';
      document.body.style.overflow = '';
      
        // Loading-Indicator verstecken
        const loading = document.getElementById('loading-indicator');
        if (loading) {
          loading.style.display = 'none';
        }
        
        // Iframe zur√ºcksetzen (optional - spart Memory)
        if (iframe) {
          setTimeout(() => {
            iframe.src = '';
          }, 300);
        }
        
        console.log('‚úÖ Modal geschlossen');
      
      // Analytics (optional)
      if (typeof gtag !== 'undefined') {
        gtag('event', 'workflow_closed', {
          'event_category': 'engagement'
        });
        }
      } catch (e) {
        console.error('‚ùå Fehler beim Schlie√üen des Modals:', e);
        // Fallback: Modal mit CSS verstecken
        const modal = document.getElementById('workflow-modal');
        if (modal) {
          modal.style.display = 'none';
          document.body.style.overflow = '';
        }
      }
    }
    
    // ========================================
    // EVENT LISTENERS
    // ========================================
    
    document.addEventListener('DOMContentLoaded', () => {
      // WICHTIG: Upload-Handler ZUERST registrieren (h√∂here Priorit√§t)
      const fileInput = document.getElementById('business-card-upload-input');
      const uploadLabel = document.querySelector('label[for="business-card-upload-input"]');
      
      // File Input Handler f√ºr Upload (WICHTIG: Vor Card-Handler!)
      if (uploadLabel && fileInput) {
        uploadLabel.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation(); // Verhindere alle anderen Handler
          
          console.log('üì§ Upload-Label geklickt');
          
          // √ñffne File Input Dialog
          fileInput.click();
          console.log('‚úÖ File Input Dialog ge√∂ffnet');
        }, { capture: true }); // Capture Phase f√ºr h√∂here Priorit√§t
      }
      
      // Click handlers for demo cards (nach Upload-Handler)
      const links = document.querySelectorAll('.demo-card-link');
      
      console.log('üìã Gefundene Demo-Cards:', links.length);
      links.forEach((link, index) => {
        const url = link.getAttribute('data-workflow-url');
        const title = link.getAttribute('data-title');
        console.log(`Card ${index + 1}:`, { url, title, hasUrl: !!url });
      });
      
      links.forEach(link => {
        link.addEventListener('click', async (e) => {
          // Skip Upload Label - wird separat behandelt (WICHTIG: Vor preventDefault!)
          if (link.tagName === 'LABEL' && link.getAttribute('for') === 'business-card-upload-input') {
            e.stopPropagation();
            return; // Lass den File Input Handler das √ºbernehmen
          }
          
          e.preventDefault();
          
          const workflowUrl = link.getAttribute('data-workflow-url');
          const workflowTitle = link.getAttribute('data-title');
          const sampleParam = link.getAttribute('data-params');
          
          console.log('üîç Click auf Card:', { 
            workflowUrl, 
            workflowTitle, 
            sampleParam,
            linkElement: link,
            hasDataTitle: link.hasAttribute('data-title'),
            hasDataParams: link.hasAttribute('data-params')
          });
          
          // KEINE Demo-Daten mehr - nur echte AI-Responses werden angezeigt
          // √ñffne Modal und triggere Workflow
          if (!workflowUrl) {
            console.error('‚ùå Workflow-URL nicht gefunden f√ºr:', workflowTitle);
            alert('‚ö†Ô∏è Workflow-URL ist nicht konfiguriert! Bitte pr√ºfe die data-workflow-url Attribute.');
            return;
          }
          
          // FIX: √úbergebe den Link DIREKT, nicht nur workflowTitle!
          // Das verhindert dass immer nur Sample 1 verwendet wird
          console.log('‚úÖ √ñffne Modal mit:', { workflowUrl, workflowTitle, sampleParam, linkElement: link });
          await openWorkflowModal(workflowUrl, workflowTitle, null, link);
          
          // Modal bleibt offen - Ergebnisse erscheinen automatisch in der Tabelle
          // Nutzer kann Modal manuell schlie√üen oder es bleibt offen bis Results kommen
        });
      });
      
      // File Input Change Handler (f√ºr nach Datei-Auswahl)
      if (fileInput) {
        // Stelle sicher, dass File Input sichtbar ist f√ºr Screen Reader
        const uploadLabelText = window.i18n?.t('modal.upload.label') || 'Visitenkarte hochladen';
        fileInput.setAttribute('aria-label', uploadLabelText);
        
        fileInput.addEventListener('change', async (e) => {
          const file = e.target.files?.[0];
          if (!file) {
            console.log('‚ö†Ô∏è Keine Datei ausgew√§hlt');
            return;
          }
          
          // Validiere Datei
          if (!file.type.startsWith('image/')) {
            const imageOnlyMsg = window.i18n?.t('modal.upload.imageOnly') || '‚ö†Ô∏è Bitte laden Sie nur Bilddateien (JPG, PNG) hoch!';
            alert(imageOnlyMsg);
            fileInput.value = '';
            return;
          }
          
          if (file.size > 10 * 1024 * 1024) {
            const fileTooLargeMsg = window.i18n?.t('modal.upload.fileTooLarge') || '‚ö†Ô∏è Die Datei ist zu gro√ü (max. 10 MB)!';
            alert(fileTooLargeMsg);
            fileInput.value = '';
            return;
          }
          
          const workflowUrl = 'https://n8n2.kortex-system.de/webhook/business-card-extraction';
          console.log('üì§ Upload gestartet:', { workflowUrl, fileName: file.name, fileSize: file.size });
          
          // √ñffne Modal und √ºbergebe File direkt
          const ownCardTitle = window.i18n?.t('modal.upload.ownCard') || 'Eigene Visitenkarte hochladen';
          await openWorkflowModal(workflowUrl, ownCardTitle, file);
          
          // Modal bleibt offen - Ergebnisse erscheinen automatisch in der Tabelle
          // Nutzer kann Modal manuell schlie√üen oder es bleibt offen bis Results kommen
          
          // Reset File Input nach Upload
          fileInput.value = '';
        });
      }
      
      // Close button - SICHERSTELLEN dass es funktioniert
      const closeBtn = document.getElementById('workflow-close-btn');
      if (closeBtn) {
        closeBtn.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          closeWorkflowModal();
        });
      } else {
        console.error('‚ùå Close-Button nicht gefunden!');
      }
      
      // Close on ESC key - GLOBAL (funktioniert immer)
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' || e.keyCode === 27) {
          const modal = document.getElementById('workflow-modal');
          if (modal && modal.classList.contains('active')) {
          closeWorkflowModal();
          }
        }
      });
      
      // Close on background click - SICHERSTELLEN dass es funktioniert
      const modal = document.getElementById('workflow-modal');
      if (modal) {
        modal.addEventListener('click', (e) => {
        if (e.target.id === 'workflow-modal') {
          closeWorkflowModal();
        }
      });
      }
      
      console.log('‚úÖ Kortex n8n Modal Integration geladen');
      console.log('üìä Gefundene Demo-Cards:', links.length);
      
      // Update translations when language changes
      window.addEventListener('languagechange', () => {
        if (window.i18n) {
          window.i18n.updateTranslations();
        }
      });

      // Download Buttons
      document.getElementById('btn-download-csv')?.addEventListener('click', downloadCSV);
      document.getElementById('btn-download-json')?.addEventListener('click', downloadJSON);
      
      // Clear Button
      document.getElementById('btn-clear-results')?.addEventListener('click', () => {
        const confirmText = window.i18n?.t('modal.results.confirm') || 'M√∂chten Sie wirklich alle extrahierten Kontaktdaten l√∂schen?';
        if (extractedResults.length > 0 && confirm(confirmText)) {
          clearAllResults();
        }
      });
      
      // Automatisches L√∂schen alle 1 Stunde (3600 Sekunden = 3600000 Millisekunden)
      setInterval(() => {
        if (extractedResults.length > 0) {
          console.log('üïê Automatisches L√∂schen: Alle Daten werden nach 1 Stunde bereinigt');
          clearAllResults(false); // Keine Best√§tigung beim automatischen L√∂schen
        }
      }, 3600000); // 1 Stunde = 3600000 ms
      
      console.log('‚úÖ Automatisches L√∂schen aktiviert: Alle 1 Stunde');
    });
    
    // ========================================
    // COMMUNICATION WITH IFRAME (optional)
    // ========================================
    
    // Ergebnisse lokal halten
    const extractedResults = [];

    function renderResults() {
      const tbody = document.getElementById('results-tbody');
      const countElement = document.getElementById('results-count');
      
      if (!tbody) return;
      
      // Update count
      if (countElement) {
        countElement.textContent = `(${extractedResults.length})`;
      }
      
      if (extractedResults.length === 0) {
        const emptyText = window.i18n?.t('modal.results.empty') || 'Noch keine Ergebnisse. Starte eine Demo oben.';
        tbody.innerHTML = `<tr><td colspan="8" style="padding:16px; color:#94a3b8;">${emptyText}</td></tr>`;
        return;
      }
      const lang = window.i18n?.getCurrentLanguage() || 'de';
      const nameLabel = window.i18n?.t('modal.table.name') || 'Name';
      const companyLabel = window.i18n?.t('modal.table.company') || 'Firma';
      const emailLabel = window.i18n?.t('modal.table.email') || 'E-Mail';
      const phoneLabel = window.i18n?.t('modal.table.phone') || 'Telefon';
      const addressLabel = window.i18n?.t('modal.table.address') || 'Adresse';
      const websiteLabel = window.i18n?.t('modal.table.website') || 'Website';
      const sourceLabel = window.i18n?.t('modal.table.source') || 'Quelle';
      const timeLabel = window.i18n?.t('modal.table.time') || 'Zeit';
      
      tbody.innerHTML = extractedResults.map((r, index) => {
        const address = (r.address || '') + (r.city ? (r.address ? ', ' : '') + r.city : '');
        const website = r.website || r.url || '';
        const websiteLink = website ? (website.startsWith('http') ? website : `https://${website}`) : '';
        return `
        <tr>
          <td data-label="${nameLabel}" style="padding:12px 16px; border-top: 1px solid rgba(148,163,184,0.15);">${escapeHtml(r.name || '')}</td>
          <td data-label="${companyLabel}" style="padding:12px 16px; border-top: 1px solid rgba(148,163,184,0.15);">${escapeHtml(r.company || '')}</td>
          <td data-label="${emailLabel}" style="padding:12px 16px; border-top: 1px solid rgba(148,163,184,0.15);">${escapeHtml(r.email || '')}</td>
          <td data-label="${phoneLabel}" style="padding:12px 16px; border-top: 1px solid rgba(148,163,184,0.15);">${escapeHtml(r.phone || '')}</td>
          <td data-label="${addressLabel}" style="padding:12px 16px; border-top: 1px solid rgba(148,163,184,0.15);">${escapeHtml(address || '')}</td>
          <td data-label="${websiteLabel}" style="padding:12px 16px; border-top: 1px solid rgba(148,163,184,0.15);">${websiteLink ? `<a href="${escapeHtml(websiteLink)}" target="_blank" rel="noopener noreferrer" style="color: #60a5fa; text-decoration: none;">${escapeHtml(website)}</a>` : ''}</td>
          <td data-label="${sourceLabel}" style="padding:12px 16px; border-top: 1px solid rgba(148,163,184,0.15);">${escapeHtml(r.source || '')}</td>
          <td data-label="${timeLabel}" style="padding:12px 16px; border-top: 1px solid rgba(148,163,184,0.15);">${new Date(r.timestamp).toLocaleString()}</td>
        </tr>
      `;
      }).join('');
    }
    
    function clearAllResults(showConfirm = true) {
      extractedResults.length = 0; // Array leeren
      renderResults();
      console.log('üóëÔ∏è Alle Kontaktdaten wurden gel√∂scht');
      
      // Optional: Toast-Benachrichtigung (falls gew√ºnscht)
      if (showConfirm) {
        // Kurze visuelle Best√§tigung
        const btn = document.getElementById('btn-clear-results');
        if (btn) {
          const originalText = btn.textContent;
          btn.textContent = '‚úÖ Gel√∂scht!';
          btn.style.background = '#22c55e';
          setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = '#ef4444';
          }, 2000);
        }
      }
    }

    function escapeHtml(s) {
      return String(s).replace(/[&<>"]+/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
    }

      function downloadCSV() {
      if (extractedResults.length === 0) return;
      const headers = ['Name','Firma','E-Mail','Telefon','Adresse','Website','Quelle','Zeitstempel'];
      const csvRows = [headers.map(h => `"${h.replace(/"/g, '""')}"`).join(',')];
      
      extractedResults.forEach(r => {
        const address = (r.address || '') + (r.city ? (r.address ? ', ' : '') + r.city : '');
        const website = r.website || r.url || '';
        const timestamp = r.timestamp ? new Date(r.timestamp).toLocaleString('de-DE') : '';
        
        const row = [
          r.name || '',
          r.company || '',
          r.email || '',
          r.phone || '',
          address,
          website,
          r.source || '',
          timestamp
        ];
        
        csvRows.push(row.map(cell => {
          const val = String(cell || '').replace(/"/g, '""');
          return `"${val}"`;
        }).join(','));
      });
      
      // UTF-8 BOM f√ºr korrekte Darstellung in Excel
      const BOM = '\uFEFF';
      const csv = BOM + csvRows.join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'visitenkarten-export.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function downloadJSON() {
      if (extractedResults.length === 0) return;
      const blob = new Blob([JSON.stringify(extractedResults, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'business-cards.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    window.addEventListener('message', (event) => {
      // Security check - adjust origins as needed
      const allowedOrigins = [
        'https://koretex-invoice-db.onrender.com',
        'https://n8n.kortex.de',
        'https://n8n2.kortex-system.de',
        'http://localhost:5000'
      ];
      
      // Check if message is from an allowed origin
      const isAllowed = allowedOrigins.some(origin => event.origin.includes(origin));
      if (!isAllowed) {
        console.warn('‚ö†Ô∏è PostMessage von nicht erlaubter Origin:', event.origin);
        return;
      }
      
      console.log('üì© Message from workflow:', event.data);
      
      // Handle different event types
      if (event.data?.type === 'business-card-processed') {
        const p = event.data.payload || {};
          extractedResults.unshift({
            name: p.name || '',
            company: p.company || '',
            email: p.email || '',
            phone: p.phone || '',
            address: p.address || '',
            city: p.city || '',
            website: p.website || p.url || '',
            source: p.source || (p.sample ? `Sample ${p.sample}` : 'Upload'),
            timestamp: p.timestamp || new Date().toISOString()
          });
        // Zeige Success-Indicator
        const loading = document.getElementById('loading-indicator');
        if (loading) {
          showSuccessIndicator(loading, 'Daten erfolgreich extrahiert!');
        }
        
        renderResults();
        
        console.log('‚úÖ Daten via PostMessage in Tabelle eingef√ºgt:', {
          name: p.name || '(leer)',
          company: p.company || '(leer)',
          email: p.email || '(leer)',
          source: p.source || (p.sample ? `Sample ${p.sample}` : 'Upload')
        });
        
        // Auto-Close Modal nach 1.5 Sekunden und scrollen zur Tabelle
        setTimeout(() => {
          closeWorkflowModal();
          scrollToResults();
          console.log('‚úÖ Modal automatisch geschlossen nach PostMessage-Extraktion');
        }, 1500);
      }

      if (event.data.type === 'workflow-complete') {
        console.log('‚úÖ Workflow abgeschlossen');
        
        // Zeige Success-Indicator
        const loading = document.getElementById('loading-indicator');
        if (loading) {
          showSuccessIndicator(loading);
        }
        
        // Auto-Close Modal nach 1.5 Sekunden und scrollen zur Tabelle
        setTimeout(() => {
          closeWorkflowModal();
          scrollToResults();
          console.log('‚úÖ Modal automatisch geschlossen nach Workflow-Completion');
        }, 1500);
      }
      
      if (event.data.type === 'close-requested') {
        closeWorkflowModal();
      }
    });
  </script>
  <script src="./components/cookie-banner.js"></script>
</body>
</html>

